# メール送信（SMTP）の設定方法

予約確定メール・リマインドメールを送るには、プロジェクト直下の **`.env.local`** に SMTP を設定します。

## 必須の変数

| 変数名 | 説明 | 例 |
|--------|------|-----|
| `SMTP_HOST` | メールサーバーのアドレス | `smtp.gmail.com` または 社内SMTP のホスト名 |

**これだけで送信できます。** 認証不要の SMTP サーバー（社内リレーやローカルなど）の場合は、`SMTP_HOST` と必要なら `SMTP_PORT` だけ設定すれば送信されます。

## 認証あり（Gmail など）の場合に追加する変数

| 変数名 | 説明 | 例 |
|--------|------|-----|
| `SMTP_USER` | 送信に使うメールアドレス | `yourname@gmail.com` |
| `SMTP_PASS` | パスワード（Gmailの場合はアプリパスワード） | 16文字の英数字 |

## 任意で設定できる変数

| 変数名 | 説明 | 例 |
|--------|------|-----|
| `SMTP_PORT` | ポート番号（未設定なら 587） | `587` |
| `SMTP_SECURE` | SSL/TLS を使うか | `false`（587のときは false でOK） |
| `MAIL_FROM` | 送信元表示アドレス（未設定なら SMTP_USER または noreply@localhost） | `noreply@example.com` |

---

## 認証なしで送る（社内SMTP・ローカルリレーなど）

認証が不要な SMTP サーバーを使う場合は、次のように **SMTP_HOST だけ**（必要なら SMTP_PORT も）書きます。

```env
SMTP_HOST=社内のSMTPサーバーアドレス
SMTP_PORT=25
MAIL_FROM=noreply@yourdomain.com
```

- `SMTP_USER` と `SMTP_PASS` は不要です。
- 送信元アドレスを明示したい場合は `MAIL_FROM` を設定してください。

---

## Gmail で設定する手順（認証あり）

### 1. Googleアカウントで「2段階認証」を有効にする

1. [Googleアカウント](https://myaccount.google.com/) → **セキュリティ**
2. **2段階認証** をオンにする

### 2. アプリパスワードを作る

1. 同じ「セキュリティ」画面で **アプリパスワード** を開く  
   （2段階認証をオンにしていないと表示されません）
2. 「アプリを選択」→ **メール**
3. 「デバイスを選択」→ **その他** に任意の名前（例: Abodyジム）を入力
4. **生成** を押す
5. 表示された **16文字のパスワード** をコピーする（スペースは含めない）

### 3. `.env.local` に追記する

プロジェクトの直下（`package.json` がある場所）の `.env.local` を開き、次のように追加します。

```env
# メール送信用（Gmail の例）
SMTP_HOST=smtp.gmail.com
SMTP_USER=あなたのGmailアドレス@gmail.com
SMTP_PASS=ここに16文字のアプリパスワードを貼り付け
```

- `SMTP_USER` には Gmail のメールアドレスをそのまま書く
- `SMTP_PASS` には、手順2で作った **アプリパスワード** を貼り付ける（通常のログインパスワードは使わない）

### 4. 開発サーバーを再起動する

`.env.local` を変更したあとは、`npm run dev` を一度止めて、もう一度起動してください。

---

## その他のメールサービス例

| サービス | SMTP_HOST | 備考 |
|----------|-----------|------|
| Gmail | `smtp.gmail.com` | アプリパスワード必須 |
| Outlook / Microsoft 365 | `smtp.office365.com` | ポート 587 |
| Yahoo!メール | `smtp.mail.yahoo.co.jp` | アプリパスワードが必要な場合あり |
| さくらインターネット等のレンタルサーバー | サーバー案内の「SMTPサーバー」 | 契約時のメール設定を参照 |

---

## 動作確認

1. data シートの F 列に、予約する会員のメールアドレスが入っているか確認する
2. 上記のとおり `.env.local` を設定し、`npm run dev` を再起動する
3. 予約を1件入れて、予約完了画面で「確認メールを送信しました」と出るか確認する
4. 届いたメールが迷惑メールフォルダに入っていないかも確認する
