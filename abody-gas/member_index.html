<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Abody ãƒã‚¤ã‚«ãƒ«ãƒ†</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container { max-width: 900px; margin: 0 auto; }
    
    .header {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      margin-bottom: 24px;
      text-align: center;
    }
    .header h1 {
      font-size: 28px;
      color: #333;
      margin-bottom: 8px;
    }
    .header .member-name {
      font-size: 20px;
      color: #667eea;
      font-weight: 600;
    }
    
    #login-screen {
      max-width: 500px;
      margin: 0 auto;
    }
    
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 20px;
      overflow-x: auto;
    }
    .tab {
      padding: 14px 20px;
      background: rgba(255,255,255,0.9);
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 15px;
      font-weight: 600;
      color: #666;
      transition: all 0.3s;
      white-space: nowrap;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .tab:hover { background: white; transform: translateY(-2px); }
    .tab.active {
      background: white;
      color: #667eea;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .card {
      background: white;
      padding: 24px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      margin-bottom: 20px;
    }
    .card h2 {
      font-size: 20px;
      margin-bottom: 16px;
      color: #667eea;
      border-bottom: 3px solid #667eea;
      padding-bottom: 10px;
    }
    .card h3 {
      font-size: 18px;
      margin: 20px 0 12px 0;
      color: #333;
    }
    
    .session-item {
      padding: 16px;
      border-left: 4px solid #667eea;
      background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
      margin-bottom: 16px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    .session-item .date { 
      font-weight: 600; 
      color: #333;
      font-size: 16px;
    }
    .session-item .trainer { 
      color: #666; 
      font-size: 14px;
      margin-top: 4px;
    }
    .session-item .part { 
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      margin-top: 8px;
      font-weight: 600;
    }
    .menu-list { 
      margin-top: 12px; 
      padding-left: 20px;
      background: white;
      padding: 12px;
      border-radius: 8px;
    }
    .menu-item { 
      font-size: 14px;
      color: #555;
      margin: 6px 0;
      padding-left: 8px;
      border-left: 2px solid #667eea;
    }
    
    .ai-text {
      white-space: pre-wrap;
      line-height: 1.8;
      color: #333;
      background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
      padding: 20px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .target-photo {
      max-width: 100%;
      max-height: 500px;
      border-radius: 12px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.2);
      margin: 16px 0;
      display: block;
    }
    
    .ai-status {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 16px;
    }
    .ai-status.success { background: #34C759; color: white; }
    .ai-status.error { background: #FF3B30; color: white; }
    .ai-status.pending { background: #FF9500; color: white; }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin: 20px 0;
    }
    
    .metric-box {
      background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .metric-box .label {
      font-size: 13px;
      color: #666;
      margin-bottom: 8px;
      font-weight: 600;
    }
    
    .metric-box .value {
      font-size: 24px;
      color: #667eea;
      font-weight: 700;
    }
    
    .metric-box .unit {
      font-size: 14px;
      color: #999;
      margin-left: 4px;
    }
    
    .recommendation-item {
      background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%);
      padding: 16px;
      border-radius: 8px;
      margin-bottom: 12px;
      border-left: 4px solid #667eea;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .recommendation-item .category {
      display: inline-block;
      background: #667eea;
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .recommendation-item .priority {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 8px;
    }
    
    .recommendation-item .priority.high {
      background: #FF3B30;
      color: white;
    }
    
    .recommendation-item .priority.medium {
      background: #FF9500;
      color: white;
    }
    
    .recommendation-item .priority.good {
      background: #34C759;
      color: white;
    }
    
    .recommendation-item .message {
      font-size: 15px;
      color: #333;
      margin: 8px 0;
      font-weight: 500;
    }
    
    .recommendation-item .action {
      font-size: 14px;
      color: #666;
      padding-left: 12px;
      border-left: 2px solid #667eea;
      margin-top: 8px;
    }
    
    .progress-bar {
      background: #e0e0e0;
      border-radius: 10px;
      height: 20px;
      overflow: hidden;
      margin: 8px 0;
    }
    
    .progress-bar-fill {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      height: 100%;
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 12px;
      font-weight: 600;
    }
    
    .info-box {
      background: #f8f9fa;
      padding: 16px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
      margin: 16px 0;
    }
    
    .info-box .title {
      font-weight: 600;
      color: #333;
      margin-bottom: 8px;
      font-size: 15px;
    }
    
    .info-box .content {
      font-size: 14px;
      color: #666;
      line-height: 1.6;
    }
    
    .empty { 
      color: #999; 
      text-align: center; 
      padding: 60px 20px;
      font-size: 16px;
    }
    
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: white;
      font-size: 18px;
    }
    
    input[type="text"],
    input[type="email"],
    input[type="number"] {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      border: 2px solid #ddd;
      border-radius: 8px;
      margin-bottom: 8px;
    }
    
    button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }
    
    .hint {
      font-size: 13px;
      color: #999;
      margin-top: 4px;
      margin-bottom: 16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ’ª Abody ãƒã‚¤ã‚«ãƒ«ãƒ†</h1>
      <div class="member-name" id="memberName">ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ãã ã•ã„</div>
    </div>
    
    <!-- ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ -->
    <div id="login-screen">
      <div class="card">
        <h2>ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</h2>
        <div>
          <label for="memberIdInput">ä¼šå“¡IDï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰</label>
          <input type="text" id="memberIdInput" placeholder="ä¾‹: EBI001">
          <p class="hint">â€»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã ã‘ã§ã‚‚ãƒ­ã‚°ã‚¤ãƒ³ã§ãã¾ã™</p>
        </div>
        
        <div>
          <label for="emailInput">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆå¿…é ˆï¼‰</label>
          <input type="email" id="emailInput" placeholder="ä¾‹: test@gmail.com">
          <p class="hint">â€»Abodyã«ç™»éŒ²æ¸ˆã¿ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
        </div>
        
        <button id="loginBtn" onclick="handleLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
      </div>
    </div>
    
    <div id="loading" class="loading" style="display: none;">
      èª­ã¿è¾¼ã¿ä¸­...
    </div>
    
    <div id="content" style="display: none;">
      <div class="tabs">
        <button class="tab active" onclick="switchTab(event, 'ai2026')">ğŸ¯ ç›®æ¨™é”æˆãƒ—ãƒ©ãƒ³</button>
        <button class="tab" onclick="switchTab(event, 'ideal')">ğŸ“Š ç†æƒ³å€¤åˆ†æ</button>
        <button class="tab" onclick="switchTab(event, 'weight')">ä½“é‡æ¨ç§»</button>
        <button class="tab" onclick="switchTab(event, 'latest')">æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³</button>
        <button class="tab" onclick="switchTab(event, 'posture')">å§¿å‹¢è©•ä¾¡ (AI)</button>
        <button class="tab" onclick="switchTab(event, 'history')">å±¥æ­´</button>
      </div>
      
      <!-- 2026å¹´ç›®æ¨™AI -->
      <div id="tab-ai2026" class="tab-content active">
        <div class="card">
          <h2>ğŸ¯ 2026å¹´ç›®æ¨™é”æˆãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</h2>
          <div id="ai2026-content"></div>
          <div id="progress-plan-content"></div>
        </div>
      </div>
      
      <!-- ç†æƒ³å€¤åˆ†æ -->
      <div id="tab-ideal" class="tab-content">
        <div class="card">
          <h2>ğŸ“Š ã‚ãªãŸã®ç†æƒ³å€¤åˆ†æ</h2>
          <div id="ideal-content"></div>
        </div>
      </div>
      
      <!-- ä½“é‡æ¨ç§» -->
      <div id="tab-weight" class="tab-content">
        <div class="card">
          <h2>âš–ï¸ ä½“é‡æ¨ç§»</h2>
          
          <div style="background: linear-gradient(135deg, #f8f9ff 0%, #fff 100%); padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <h3 style="margin-bottom: 12px; color: #333;">ä»Šæ—¥ã®ä½“é‡ã‚’è¨˜éŒ²</h3>
            <div style="display: flex; gap: 12px; align-items: flex-start;">
              <div style="flex: 1;">
                <input type="number" id="weightInput" placeholder="ä½“é‡ï¼ˆkgï¼‰" step="0.1" min="0" max="300">
              </div>
              <button onclick="saveWeight()" style="width: auto; padding: 12px 24px;">è¨˜éŒ²</button>
            </div>
          </div>
          
          <div id="weight-chart"></div>
          <div id="weight-list"></div>
        </div>
      </div>
      
      <!-- æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³ -->
      <div id="tab-latest" class="tab-content">
        <div class="card">
          <h2>ğŸ“… æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³</h2>
          <div id="latest-content"></div>
        </div>
      </div>
      
      <!-- å§¿å‹¢è©•ä¾¡ -->
      <div id="tab-posture" class="tab-content">
        <div class="card">
          <h2>ğŸ§˜ å§¿å‹¢è©•ä¾¡ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ (AI)</h2>
          <div id="posture-content"></div>
        </div>
      </div>
      
      <!-- å±¥æ­´ä¸€è¦§ -->
      <div id="tab-history" class="tab-content">
        <div class="card">
          <h2>ğŸ“Š ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å±¥æ­´</h2>
          <div id="history-content"></div>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentTab = 'ai2026';
    
    // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†
    function handleLogin() {
      const memberId = document.getElementById('memberIdInput').value.trim();
      const email = document.getElementById('emailInput').value.trim();
      
      if (!email) {
        alert('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      
      document.getElementById('login-screen').style.display = 'none';
      document.getElementById('loading').style.display = 'block';
      
      google.script.run
        .withSuccessHandler(function(result) {
          document.getElementById('loading').style.display = 'none';
          
          if (!result.ok) {
            alert(result.message);
            document.getElementById('login-screen').style.display = 'block';
            return;
          }
          
          // ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
          document.getElementById('content').style.display = 'block';
          document.getElementById('memberName').textContent = 
            result.memberInfo?.name || result.memberId;
          
          renderLatest(result.latest);
          renderPosture(result.posture);
          renderAi2026(result.ai2026, result.idealMetrics, result.progressPlan);
          renderIdealMetrics(result.idealMetrics, result.ai2026);
          renderHistory(result.history);
          renderWeightLog(result.weightLog);
        })
        .withFailureHandler(function(error) {
          document.getElementById('loading').style.display = 'none';
          document.getElementById('login-screen').style.display = 'block';
          alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .mw_api_login(memberId, email);
    }
    
    // Enter ã‚­ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('emailInput').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          handleLogin();
        }
      });
    });
    
    function switchTab(event, tabName) {
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      event.target.classList.add('active');
      
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');
      
      currentTab = tabName;
    }
    
    function saveWeight() {
      alert('ä½“é‡è¨˜éŒ²æ©Ÿèƒ½ã¯ç¾åœ¨æº–å‚™ä¸­ã§ã™');
    }
    
    function renderLatest(session) {
      const el = document.getElementById('latest-content');
      if (!session) {
        el.innerHTML = '<div class="empty">ã¾ã ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      let html = `
        <div class="session-item">
          <div class="date">${session.ts || 'æ—¥æ™‚ä¸æ˜'}</div>
          <div class="trainer">æ‹…å½“ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼: ${session.trainer || 'ä¸æ˜'}</div>
          <span class="part">${session.part || 'éƒ¨ä½ä¸æ˜'}</span>
          <div class="menu-list">
      `;
      
      session.menus.forEach(m => {
        html += `<div class="menu-item">${m.menu || 'ç¨®ç›®ä¸æ˜'} ${m.set || ''}</div>`;
      });
      
      html += '</div></div>';
      el.innerHTML = html;
    }
    
    function renderPosture(text) {
      const el = document.getElementById('posture-content');
      if (!text) {
        el.innerHTML = '<div class="empty">å§¿å‹¢è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      el.innerHTML = `<div class="ai-text">${text}</div>`;
    }
    
    function renderAi2026(data, idealMetrics, progressPlan) {
      const el = document.getElementById('ai2026-content');
      
      if (!data || !data.text) {
        el.innerHTML = '<div class="empty">2026å¹´ç›®æ¨™åˆ†æãŒã¾ã å®Œäº†ã—ã¦ã„ã¾ã›ã‚“<br>ã‚‚ã†ã™ãè¡¨ç¤ºã•ã‚Œã¾ã™ï¼</div>';
        return;
      }
      
      let statusClass = 'success';
      if (data.status === 'ERROR' || data.status === 'å¤±æ•—') statusClass = 'error';
      else if (data.status === 'å‡¦ç†ä¸­') statusClass = 'pending';
      
      let html = `
        <div style="background: #f8f9fa; padding: 16px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #667eea;">
          <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 12px;">
            <div>
              <span class="ai-status ${statusClass}">${data.status || 'OK'}</span>
              ${data.analyzedAt ? `<span style="color:#666; font-size:14px; margin-left:12px;">ğŸ“… åˆ†ææ—¥: ${data.analyzedAt}</span>` : ''}
            </div>
          </div>
        </div>
      `;
      
      if (data.photo) {
        html += `
          <div style="margin-top: 20px;">
            <h3 style="margin-bottom: 12px; color: #333;">ğŸ“¸ ã‚ãªãŸã®ç›®æ¨™å†™çœŸ</h3>
            <img src="${data.photo}" class="target-photo" alt="ç›®æ¨™å†™çœŸ" />
          </div>
        `;
      }
      
      html += `
        <div style="margin-top: 24px;">
          <h3 style="margin-bottom: 12px; color: #333;">ğŸ“Š ã‚ãªãŸå°‚ç”¨ã®é”æˆãƒ—ãƒ©ãƒ³</h3>
          <div class="ai-text">${data.text}</div>
        </div>
      `;
      
      el.innerHTML = html;
      
      // é€²æ—ãƒ—ãƒ©ãƒ³ã®è¡¨ç¤º
      renderProgressPlan(progressPlan, data);
    }
    
    function renderProgressPlan(plan, ai2026) {
      const el = document.getElementById('progress-plan-content');
      
      if (!plan || !plan.hasPlan) {
        el.innerHTML = '';
        return;
      }
      
      let html = '<div style="margin-top: 32px;">';
      html += '<h3>ğŸ¯ ç›®æ¨™é”æˆã¸ã®é“ã®ã‚Š</h3>';
      
      // ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³æƒ…å ±
      if (plan.timeline) {
        const progress = plan.timeline.weeksRemaining > 0 ? 
          Math.max(0, Math.min(100, 100 - (plan.timeline.weeksRemaining / 48 * 100))) : 0;
        
        html += `
          <div class="info-box">
            <div class="title">â±ï¸ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</div>
            <div class="content">
              æ®‹ã‚Šæ™‚é–“: <strong>${plan.timeline.monthsRemaining}ãƒ¶æœˆ (${plan.timeline.weeksRemaining}é€±)</strong><br>
              ç›®æ¨™é”æˆæ—¥: <strong>${plan.goals.deadline}</strong><br>
              é€±ã‚ãŸã‚Šã®ç›®æ¨™æ¸›é‡: <strong>${plan.timeline.weeklyWeightLoss}kg</strong>
            </div>
            <div class="progress-bar" style="margin-top: 12px;">
              <div class="progress-bar-fill" style="width: ${progress}%;">${Math.round(progress)}%</div>
            </div>
          </div>
        `;
      }
      
      // ç¾åœ¨å€¤ã¨ç›®æ¨™å€¤ã®æ¯”è¼ƒ
      html += '<div class="metrics-grid">';
      
      if (plan.currentStatus.weight && plan.goals.weight) {
        const diff = plan.currentStatus.weight - plan.goals.weight;
        html += `
          <div class="metric-box">
            <div class="label">ä½“é‡</div>
            <div class="value">${plan.currentStatus.weight}<span class="unit">kg</span></div>
            <div style="font-size: 13px; color: #666; margin-top: 8px;">
              ç›®æ¨™: ${plan.goals.weight}kg<br>
              æ®‹ã‚Š: <strong style="color: #667eea;">${diff.toFixed(1)}kg</strong>
            </div>
          </div>
        `;
      }
      
      if (plan.currentStatus.bodyFat && plan.goals.bodyFat) {
        const diff = plan.currentStatus.bodyFat - plan.goals.bodyFat;
        html += `
          <div class="metric-box">
            <div class="label">ä½“è„‚è‚ªç‡</div>
            <div class="value">${plan.currentStatus.bodyFat}<span class="unit">%</span></div>
            <div style="font-size: 13px; color: #666; margin-top: 8px;">
              ç›®æ¨™: ${plan.goals.bodyFat}%<br>
              æ®‹ã‚Š: <strong style="color: #667eea;">${diff.toFixed(1)}%</strong>
            </div>
          </div>
        `;
      }
      
      if (plan.currentStatus.leanMass && plan.goals.leanMass) {
        const diff = plan.goals.leanMass - plan.currentStatus.leanMass;
        html += `
          <div class="metric-box">
            <div class="label">é™¤è„‚è‚ªä½“é‡</div>
            <div class="value">${plan.currentStatus.leanMass}<span class="unit">kg</span></div>
            <div style="font-size: 13px; color: #666; margin-top: 8px;">
              ç›®æ¨™: ${plan.goals.leanMass}kg<br>
              å¢—åŠ ç›®æ¨™: <strong style="color: #667eea;">+${diff.toFixed(1)}kg</strong>
            </div>
          </div>
        `;
      }
      
      if (plan.currentStatus.bmi) {
        html += `
          <div class="metric-box">
            <div class="label">BMI</div>
            <div class="value">${plan.currentStatus.bmi}</div>
            <div style="font-size: 13px; color: #666; margin-top: 8px;">
              ${plan.currentStatus.bmi < 18.5 ? 'ä½ä½“é‡' : 
                plan.currentStatus.bmi < 25 ? 'æ¨™æº–' : 
                plan.currentStatus.bmi < 30 ? 'è‚¥æº€(1åº¦)' : 'è‚¥æº€(2åº¦ä»¥ä¸Š)'}
            </div>
          </div>
        `;
      }
      
      html += '</div>';
      
      // ãƒ¬ã‚³ãƒ¡ãƒ³ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      if (plan.recommendations && plan.recommendations.length > 0) {
        html += '<h3 style="margin-top: 24px;">ğŸ’¡ ã‚ãªãŸã¸ã®ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h3>';
        
        plan.recommendations.forEach(rec => {
          let priorityClass = 'good';
          let priorityText = rec.priority;
          
          if (rec.priority === 'é«˜') {
            priorityClass = 'high';
            priorityText = 'é‡è¦';
          } else if (rec.priority === 'ä¸­') {
            priorityClass = 'medium';
            priorityText = 'æ¨å¥¨';
          } else if (rec.priority === 'è‰¯å¥½') {
            priorityClass = 'good';
            priorityText = 'ç¶™ç¶š';
          }
          
          html += `
            <div class="recommendation-item">
              <div>
                <span class="category">${rec.category}</span>
                <span class="priority ${priorityClass}">${priorityText}</span>
              </div>
              <div class="message">${rec.message}</div>
              <div class="action">ğŸ’ª ${rec.action}</div>
            </div>
          `;
        });
      }
      
      html += '</div>';
      el.innerHTML = html;
    }
    
    function renderIdealMetrics(metrics, ai2026) {
      const el = document.getElementById('ideal-content');
      
      if (!metrics || !metrics.hasHeight) {
        el.innerHTML = `
          <div class="empty">
            èº«é•·ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ç†æƒ³å€¤ã‚’è¨ˆç®—ã§ãã¾ã›ã‚“ã€‚<br>
            ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ã«èº«é•·ãƒ‡ãƒ¼ã‚¿ã®ç™»éŒ²ã‚’ãŠé¡˜ã„ã—ã¦ãã ã•ã„ã€‚
          </div>
        `;
        return;
      }
      
      let html = `
        <div class="info-box">
          <div class="title">ğŸ“ ã‚ãªãŸã®èº«ä½“ãƒ‡ãƒ¼ã‚¿</div>
          <div class="content">
            èº«é•·: <strong>${metrics.height}cm</strong>
            ${metrics.bmi ? `<br>ç¾åœ¨ã®BMI: <strong>${metrics.bmi}</strong>` : ''}
          </div>
        </div>
      `;
      
      html += '<h3>ğŸ¯ ç†æƒ³ã®ä½“çµ„æˆ</h3>';
      html += '<div class="metrics-grid">';
      
      html += `
        <div class="metric-box">
          <div class="label">ç†æƒ³ä½“é‡ (BMI 22åŸºæº–)</div>
          <div class="value">${metrics.idealWeight}<span class="unit">kg</span></div>
        </div>
      `;
      
      html += `
        <div class="metric-box">
          <div class="label">ç†æƒ³ä½“è„‚è‚ªç‡</div>
          <div class="value">${metrics.idealBodyFat}<span class="unit">%</span></div>
          <div style="font-size: 12px; color: #999; margin-top: 4px;">ã‚¢ã‚¹ãƒªãƒ¼ãƒˆåŸºæº–</div>
        </div>
      `;
      
      html += `
        <div class="metric-box">
          <div class="label">ç†æƒ³é™¤è„‚è‚ªä½“é‡</div>
          <div class="value">${metrics.idealLeanMass}<span class="unit">kg</span></div>
          <div style="font-size: 12px; color: #999; margin-top: 4px;">ç­‹è‚‰é‡ã®ç›®å®‰</div>
        </div>
      `;
      
      html += '</div>';
      
      // ç›®æ¨™ã¨ã®æ¯”è¼ƒ
      if (ai2026 && ai2026.currentWeight && ai2026.targetWeight) {
        html += '<h3 style="margin-top: 24px;">ğŸ“Š ç¾åœ¨å€¤ã¨ç›®æ¨™å€¤ã®æ¯”è¼ƒ</h3>';
        html += '<div class="metrics-grid">';
        
        html += `
          <div class="metric-box">
            <div class="label">ä½“é‡</div>
            <div class="value">${ai2026.currentWeight}<span class="unit">kg</span></div>
            <div style="font-size: 13px; color: #666; margin-top: 8px;">
              ç›®æ¨™: ${ai2026.targetWeight}kg<br>
              ç†æƒ³: ${metrics.idealWeight}kg
            </div>
          </div>
        `;
        
        if (ai2026.currentBodyFat && ai2026.targetBodyFat) {
          html += `
            <div class="metric-box">
              <div class="label">ä½“è„‚è‚ªç‡</div>
              <div class="value">${ai2026.currentBodyFat}<span class="unit">%</span></div>
              <div style="font-size: 13px; color: #666; margin-top: 8px;">
                ç›®æ¨™: ${ai2026.targetBodyFat}%<br>
                ç†æƒ³: ${metrics.idealBodyFat}%
              </div>
            </div>
          `;
        }
        
        if (ai2026.currentLeanMass && ai2026.targetLeanMass) {
          html += `
            <div class="metric-box">
              <div class="label">é™¤è„‚è‚ªä½“é‡</div>
              <div class="value">${ai2026.currentLeanMass}<span class="unit">kg</span></div>
              <div style="font-size: 13px; color: #666; margin-top: 8px;">
                ç›®æ¨™: ${ai2026.targetLeanMass}kg<br>
                ç†æƒ³: ${metrics.idealLeanMass}kg
              </div>
            </div>
          `;
        }
        
        html += '</div>';
      }
      
      // æ „é¤Šè¨ˆç®—
      if (metrics.calculations) {
        html += '<h3 style="margin-top: 24px;">ğŸ½ï¸ æ „é¤Šã‚¬ã‚¤ãƒ‰</h3>';
        html += '<div class="metrics-grid">';
        
        if (metrics.calculations.bmrRange) {
          html += `
            <div class="metric-box">
              <div class="label">åŸºç¤ä»£è¬é‡</div>
              <div class="value">${metrics.calculations.bmrRange.min}-${metrics.calculations.bmrRange.max}<span class="unit">kcal</span></div>
              <div style="font-size: 12px; color: #999; margin-top: 4px;">ä½•ã‚‚ã—ãªãã¦ã‚‚æ¶ˆè²»</div>
            </div>
          `;
        }
        
        if (metrics.calculations.maintenanceCalories) {
          html += `
            <div class="metric-box">
              <div class="label">ç¶­æŒã‚«ãƒ­ãƒªãƒ¼</div>
              <div class="value">${metrics.calculations.maintenanceCalories}<span class="unit">kcal</span></div>
              <div style="font-size: 12px; color: #999; margin-top: 4px;">ä½“é‡ç¶­æŒã«å¿…è¦</div>
            </div>
          `;
        }
        
        if (metrics.calculations.proteinNeeds) {
          html += `
            <div class="metric-box">
              <div class="label">æ¨å¥¨ã‚¿ãƒ³ãƒ‘ã‚¯è³ªé‡</div>
              <div class="value">${metrics.calculations.proteinNeeds.min}-${metrics.calculations.proteinNeeds.max}<span class="unit">g</span></div>
              <div style="font-size: 12px; color: #999; margin-top: 4px;">1æ—¥ã®ç›®æ¨™æ‘‚å–é‡</div>
            </div>
          `;
        }
        
        html += '</div>';
        
        // ã‚«ãƒ­ãƒªãƒ¼ã‚¬ã‚¤ãƒ‰
        if (ai2026 && ai2026.currentWeight && ai2026.targetWeight) {
          const weightDiff = ai2026.currentWeight - ai2026.targetWeight;
          let calorieAdvice = '';
          
          if (weightDiff > 0) {
            const deficitCalories = metrics.calculations.maintenanceCalories - 500;
            calorieAdvice = `
              <div class="info-box" style="margin-top: 16px;">
                <div class="title">ğŸ¯ æ¸›é‡ã®ãŸã‚ã®ã‚«ãƒ­ãƒªãƒ¼è¨­å®š</div>
                <div class="content">
                  ç›®æ¨™: <strong>ç´„${deficitCalories}kcal/æ—¥</strong><br>
                  (ç¶­æŒã‚«ãƒ­ãƒªãƒ¼ ${metrics.calculations.maintenanceCalories}kcal ã‹ã‚‰ 500kcal æ¸›)<br><br>
                  ã“ã®è¨­å®šã§é€±ç´„0.5kgãƒšãƒ¼ã‚¹ã§æ¸›é‡ã§ãã¾ã™ã€‚
                </div>
              </div>
            `;
          } else if (weightDiff < 0) {
            const surplusCalories = metrics.calculations.maintenanceCalories + 300;
            calorieAdvice = `
              <div class="info-box" style="margin-top: 16px;">
                <div class="title">ğŸ¯ å¢—é‡ã®ãŸã‚ã®ã‚«ãƒ­ãƒªãƒ¼è¨­å®š</div>
                <div class="content">
                  ç›®æ¨™: <strong>ç´„${surplusCalories}kcal/æ—¥</strong><br>
                  (ç¶­æŒã‚«ãƒ­ãƒªãƒ¼ ${metrics.calculations.maintenanceCalories}kcal ã« 300kcal è¿½åŠ )<br><br>
                  ç­‹è‚‰ã‚’å¢—ã‚„ã—ãªãŒã‚‰å¥åº·çš„ã«å¢—é‡ã§ãã¾ã™ã€‚
                </div>
              </div>
            `;
          }
          
          html += calorieAdvice;
        }
      }
      
      el.innerHTML = html;
    }
    
    function renderHistory(list) {
      const el = document.getElementById('history-content');
      if (!list || list.length === 0) {
        el.innerHTML = '<div class="empty">å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      let html = '';
      list.forEach(s => {
        html += `
          <div class="session-item">
            <div class="date">${s.ts || 'æ—¥æ™‚ä¸æ˜'}</div>
            <div class="trainer">æ‹…å½“: ${s.trainer || 'ä¸æ˜'}</div>
            <span class="part">${s.part || 'éƒ¨ä½ä¸æ˜'}</span>
            <div class="menu-list">
        `;
        
        s.menus.forEach(m => {
          html += `<div class="menu-item">${m.menu || 'ç¨®ç›®ä¸æ˜'} ${m.set || ''}</div>`;
        });
        
        html += '</div></div>';
      });
      
      el.innerHTML = html;
    }
    
    function renderWeightLog(log) {
      if (!log || log.length === 0) {
        document.getElementById('weight-list').innerHTML = '<div class="empty">ä½“é‡è¨˜éŒ²ãŒã¾ã ã‚ã‚Šã¾ã›ã‚“<br>ä¸Šã®ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰è¨˜éŒ²ã—ã¦ã¿ã¾ã—ã‚‡ã†ï¼</div>';
        document.getElementById('weight-chart').innerHTML = '';
        return;
      }
      
      const recent = log.slice(0, 30).reverse();
      const max = Math.max(...recent.map(r => r.weight));
      const min = Math.min(...recent.map(r => r.weight));
      const range = max - min || 1;
      
      let chartHtml = '<div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">';
      chartHtml += '<h3 style="margin-bottom: 16px; color: #333;">ğŸ“ˆ æ¨ç§»ã‚°ãƒ©ãƒ•ï¼ˆç›´è¿‘30æ—¥ï¼‰</h3>';
      chartHtml += '<div style="display: flex; align-items: flex-end; height: 200px; gap: 4px;">';
      
      recent.forEach((r, i) => {
        const height = ((r.weight - min) / range) * 180 + 20;
        const date = r.date.split(' ')[0].slice(5);
        chartHtml += `
          <div style="flex: 1; display: flex; flex-direction: column; align-items: center;">
            <div style="font-size: 11px; color: #667eea; font-weight: 600; margin-bottom: 4px;">${r.weight}kg</div>
            <div style="width: 100%; background: linear-gradient(180deg, #667eea 0%, #764ba2 100%); border-radius: 4px 4px 0 0; height: ${height}px;"></div>
            <div style="font-size: 10px; color: #999; margin-top: 4px; writing-mode: vertical-rl;">${date}</div>
          </div>
        `;
      });
      
      chartHtml += '</div></div>';
      document.getElementById('weight-chart').innerHTML = chartHtml;
      
      let listHtml = '<h3 style="margin: 20px 0 12px 0; color: #333;">ğŸ“‹ è¨˜éŒ²ä¸€è¦§</h3>';
      log.forEach(r => {
        listHtml += `
          <div style="padding: 12px; background: #f8f9fa; border-left: 3px solid #667eea; border-radius: 4px; margin-bottom: 8px;">
            <span style="font-weight: 600; color: #333;">${r.date}</span>
            <span style="margin: 0 12px; color: #667eea; font-size: 18px; font-weight: 600;">${r.weight}kg</span>
            <span style="font-size: 12px; color: #999;">${r.source}</span>
          </div>
        `;
      });
      
      document.getElementById('weight-list').innerHTML = listHtml;
    }
  </script>
</body>
</html>