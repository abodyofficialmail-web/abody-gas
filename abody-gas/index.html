<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Abodyã‚«ãƒ«ãƒ†ï¼ˆãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ç”¨ï¼‰</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0a0a0a;
      color: #fff;
      min-height: 100vh;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 0; }
    
    /* ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .hero-section {
      position: relative;
      height: 60vh;
      min-height: 400px;
      background: linear-gradient(135deg, #DC143C 0%, #8B0000 100%);
      background-image: 
        linear-gradient(135deg, rgba(220, 20, 60, 0.95) 0%, rgba(139, 0, 0, 0.95) 100%),
        url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=1600');
      background-size: cover;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 40px;
    }
    
    .hero-overlay {
      text-align: center;
      z-index: 2;
      padding: 40px 20px;
    }
    
    .logo-container {
      margin-bottom: 30px;
      animation: fadeInDown 0.8s ease-out;
    }
    
    .hero-logo {
      max-width: 300px;
      height: auto;
      filter: brightness(0) invert(1);
      opacity: 0.95;
    }
    
    .hero-title {
      font-size: 48px;
      font-weight: 800;
      margin-bottom: 16px;
      text-shadow: 0 4px 12px rgba(0,0,0,0.3);
      animation: fadeInUp 0.8s ease-out 0.2s both;
      letter-spacing: -1px;
    }
    
    .hero-subtitle {
      font-size: 20px;
      opacity: 0.95;
      font-weight: 300;
      animation: fadeInUp 0.8s ease-out 0.4s both;
      letter-spacing: 0.5px;
    }
    
    @keyframes fadeInDown {
      from {
        opacity: 0;
        transform: translateY(-30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    /* åº—èˆ—é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ */
    .store-select-section {
      max-width: 900px;
      margin: 0 auto 40px auto;
      padding: 0 20px;
      animation: fadeInUp 0.8s ease-out 0.6s both;
    }
    
    .store-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    
    .store-btn {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: 3px solid rgba(220, 20, 60, 0.3);
      border-radius: 20px;
      padding: 30px 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    
    .store-btn:hover {
      background: rgba(220, 20, 60, 0.1);
      border-color: #DC143C;
      transform: translateY(-8px) scale(1.05);
      box-shadow: 0 16px 32px rgba(220, 20, 60, 0.4);
    }
    
    .store-btn.selected {
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      border-color: #DC143C;
      box-shadow: 0 12px 24px rgba(220, 20, 60, 0.5);
      transform: translateY(-4px);
    }
    
    .store-icon {
      font-size: 48px;
      margin-bottom: 8px;
    }
    
    .store-name {
      font-size: 18px;
      font-weight: 700;
      color: #fff;
      text-align: center;
    }
    
    .selected-store {
      margin-left: 12px;
      padding: 4px 12px;
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      border-radius: 12px;
      font-size: 14px;
      font-weight: 700;
    }
    
    /* ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ãƒœã‚¿ãƒ³ */
    .training-form-btn {
      background: linear-gradient(135deg, #34C759 0%, #30B350 100%) !important;
      border: 2px solid #34C759 !important;
      margin-left: auto;
    }
    
    .training-form-btn:hover {
      transform: translateY(-4px) scale(1.05) !important;
      box-shadow: 0 12px 24px rgba(52, 199, 89, 0.4) !important;
    }
    
    /* ãƒ¢ãƒ¼ãƒ€ãƒ« */
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      backdrop-filter: blur(10px);
      animation: fadeIn 0.3s ease;
    }
    
    .modal.active {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .modal-content {
      background: #1a1a1a;
      border-radius: 20px;
      padding: 40px;
      max-width: 800px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      border: 2px solid #DC143C;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: slideUp 0.3s ease;
    }
    
    .form-section {
      background: rgba(220, 20, 60, 0.05);
      padding: 24px;
      border-radius: 12px;
      margin-bottom: 24px;
      border: 1px solid rgba(220, 20, 60, 0.2);
    }
    
    .section-title {
      font-size: 18px;
      font-weight: 700;
      color: #DC143C;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 2px solid #DC143C;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    
    .menu-group {
      background: rgba(255, 255, 255, 0.03);
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 16px;
      border-left: 3px solid #DC143C;
    }
    
    .menu-title {
      font-size: 16px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 16px;
    }
    
    .required {
      color: #FF3B30;
      font-weight: 700;
    }
    
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }
    
    .checkbox-label {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(220, 20, 60, 0.3);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    .checkbox-label:hover {
      background: rgba(220, 20, 60, 0.1);
      border-color: #DC143C;
    }
    
    .checkbox-label input[type="checkbox"] {
      width: 20px;
      height: 20px;
      cursor: pointer;
      accent-color: #DC143C;
    }
    
    .checkbox-label input[type="checkbox"]:checked + span {
      color: #DC143C;
      font-weight: 700;
    }
    
    .checkbox-label span {
      font-size: 15px;
      color: rgba(255, 255, 255, 0.9);
      transition: all 0.3s;
    }
    
    .set-inputs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    
    .set-input-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .set-input-label {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.7);
      font-weight: 600;
    }
    
    .add-menu-btn {
      width: 100%;
      padding: 14px;
      background: rgba(52, 199, 89, 0.2);
      border: 2px dashed #34C759;
      border-radius: 12px;
      color: #34C759;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 20px;
    }
    
    .add-menu-btn:hover {
      background: rgba(52, 199, 89, 0.3);
      transform: translateY(-2px);
    }
    
    .remove-menu-btn {
      width: 100%;
      padding: 10px;
      background: rgba(255, 59, 48, 0.2);
      border: 2px solid #FF3B30;
      border-radius: 8px;
      color: #FF3B30;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 12px;
    }
    
    .remove-menu-btn:hover {
      background: rgba(255, 59, 48, 0.3);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(50px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 20px;
      border-bottom: 2px solid #DC143C;
    }
    
    .modal-title {
      font-size: 24px;
      font-weight: 700;
      color: #DC143C;
    }
    
    .close-btn {
      background: rgba(255, 255, 255, 0.1);
      border: none;
      color: #fff;
      font-size: 28px;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      transition: all 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .close-btn:hover {
      background: #DC143C;
      transform: rotate(90deg);
    }
    
    .form-group {
      margin-bottom: 24px;
    }
    
    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .form-input,
    .form-select,
    .form-textarea {
      width: 100%;
      padding: 14px 18px;
      background: rgba(255, 255, 255, 0.05);
      border: 2px solid rgba(220, 20, 60, 0.3);
      border-radius: 12px;
      color: #fff;
      font-size: 16px;
      transition: all 0.3s;
    }
    
    .form-input:focus,
    .form-select:focus,
    .form-textarea:focus {
      outline: none;
      border-color: #DC143C;
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 4px rgba(220, 20, 60, 0.2);
    }
    
    .form-textarea {
      min-height: 100px;
      resize: vertical;
      font-family: inherit;
    }
    
    .form-submit {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      border: none;
      border-radius: 12px;
      color: white;
      font-size: 18px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    .form-submit:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 24px rgba(220, 20, 60, 0.4);
    }
    
    .form-submit:active {
      transform: translateY(0);
    }
    
    /* ãƒ¢ãƒ€ãƒ³ãªä¼šå“¡é¸æŠ */
    .member-select-modern {
      max-width: 600px;
      margin: 0 auto 40px auto;
      padding: 0 20px;
      animation: fadeInUp 0.8s ease-out 0.6s both;
    }
    
    .select-label {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 12px;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .select-label .icon {
      font-size: 20px;
    }
    
    .modern-select {
      width: 100%;
      padding: 18px 24px;
      font-size: 18px;
      font-weight: 500;
      border: 3px solid #DC143C;
      border-radius: 16px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23DC143C' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 20px center;
      background-size: 24px;
      padding-right: 60px;
    }
    
    .modern-select:hover {
      background: rgba(255, 255, 255, 0.1);
      border-color: #FF1744;
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(220, 20, 60, 0.3);
    }
    
    .modern-select:focus {
      outline: none;
      border-color: #FF1744;
      box-shadow: 0 0 0 4px rgba(220, 20, 60, 0.2);
    }
    
    .modern-select option {
      background: #1a1a1a;
      color: #fff;
      padding: 12px;
    }
    
    #content {
      background: #0a0a0a;
      padding: 0 20px 40px 20px;
    }
    
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 30px;
      border-bottom: 2px solid rgba(220, 20, 60, 0.3);
      flex-wrap: wrap;
      padding: 0 20px;
    }
    .tab {
      padding: 14px 28px;
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      border: none;
      border-radius: 12px 12px 0 0;
      cursor: pointer;
      font-size: 16px;
      font-weight: 600;
      color: rgba(255, 255, 255, 0.7);
      transition: all 0.3s;
      border: 2px solid transparent;
    }
    .tab:hover { 
      background: rgba(255, 255, 255, 0.1);
      color: #fff;
      transform: translateY(-2px);
    }
    .tab.active {
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      color: white;
      border-color: #DC143C;
      box-shadow: 0 4px 12px rgba(220, 20, 60, 0.4);
    }
    
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    .card {
      background: rgba(255, 255, 255, 0.05);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      margin-bottom: 24px;
      border: 1px solid rgba(220, 20, 60, 0.2);
    }
    .card h2 {
      font-size: 24px;
      margin-bottom: 20px;
      color: #DC143C;
      border-bottom: 3px solid #DC143C;
      padding-bottom: 12px;
      font-weight: 700;
    }
    .card h3 {
      font-size: 18px;
      margin: 20px 0 16px 0;
      color: #fff;
      font-weight: 600;
    }
    
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 20px;
      margin: 20px 0;
    }
    
    .metric-box {
      background: rgba(220, 20, 60, 0.1);
      padding: 24px;
      border-radius: 16px;
      border-left: 5px solid #DC143C;
      transition: all 0.3s;
      backdrop-filter: blur(10px);
    }
    
    .metric-box:hover {
      transform: translateY(-4px);
      box-shadow: 0 12px 24px rgba(220, 20, 60, 0.3);
      background: rgba(220, 20, 60, 0.15);
    }
    
    .metric-box .label {
      font-size: 14px;
      color: rgba(255, 255, 255, 0.7);
      margin-bottom: 12px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .metric-box .value {
      font-size: 32px;
      color: #DC143C;
      font-weight: 800;
      text-shadow: 0 2px 8px rgba(220, 20, 60, 0.3);
    }
    
    .metric-box .unit {
      font-size: 18px;
      color: rgba(220, 20, 60, 0.8);
      margin-left: 4px;
    }
    
    .metric-box .sub-info {
      font-size: 13px;
      color: rgba(255, 255, 255, 0.5);
      margin-top: 12px;
      font-style: italic;
    }
    
    .comparison-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
      overflow: hidden;
      border-radius: 12px;
    }
    
    .comparison-table th,
    .comparison-table td {
      padding: 16px;
      text-align: left;
      border-bottom: 1px solid rgba(220, 20, 60, 0.2);
    }
    
    .comparison-table th {
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      color: white;
      font-weight: 700;
      text-transform: uppercase;
      font-size: 14px;
      letter-spacing: 0.5px;
    }
    
    .comparison-table tr {
      background: rgba(255, 255, 255, 0.03);
      transition: all 0.3s;
    }
    
    .comparison-table tr:hover {
      background: rgba(220, 20, 60, 0.1);
      transform: scale(1.01);
    }
    
    .comparison-table .current {
      color: #fff;
      font-weight: 700;
      font-size: 18px;
    }
    
    .comparison-table .target {
      color: #DC143C;
      font-weight: 700;
      font-size: 18px;
    }
    
    .comparison-table .ideal {
      color: #34C759;
      font-weight: 700;
      font-size: 18px;
    }
    
    .comparison-table .diff {
      color: #FF9500;
      font-weight: 700;
      font-size: 18px;
    }
    
    .recommendation-item {
      background: rgba(220, 20, 60, 0.1);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 16px;
      border-left: 5px solid #DC143C;
      transition: all 0.3s;
    }
    
    .recommendation-item:hover {
      transform: translateX(8px);
      box-shadow: 0 8px 16px rgba(220, 20, 60, 0.3);
    }
    
    .recommendation-item .category {
      display: inline-block;
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      color: white;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .recommendation-item .priority {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      margin-left: 8px;
      text-transform: uppercase;
    }
    
    .recommendation-item .priority.high {
      background: #FF3B30;
      color: white;
    }
    
    .recommendation-item .priority.medium {
      background: #FF9500;
      color: white;
    }
    
    .recommendation-item .priority.good {
      background: #34C759;
      color: white;
    }
    
    .recommendation-item .message {
      font-size: 16px;
      color: #fff;
      margin: 12px 0;
      font-weight: 500;
      line-height: 1.6;
    }
    
    .recommendation-item .action {
      font-size: 15px;
      color: rgba(255, 255, 255, 0.7);
      padding-left: 16px;
      border-left: 3px solid #DC143C;
      margin-top: 12px;
      font-style: italic;
    }
    
    .progress-bar {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      height: 24px;
      overflow: hidden;
      margin: 12px 0;
      box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    
    .progress-bar-fill {
      background: linear-gradient(90deg, #DC143C 0%, #FF1744 100%);
      height: 100%;
      transition: width 0.6s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 13px;
      font-weight: 700;
      box-shadow: 0 2px 8px rgba(220, 20, 60, 0.5);
    }
    
    .info-box {
      background: rgba(220, 20, 60, 0.1);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 12px;
      border-left: 5px solid #DC143C;
      margin: 20px 0;
    }
    
    .info-box .title {
      font-weight: 700;
      color: #DC143C;
      margin-bottom: 12px;
      font-size: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .info-box .content {
      font-size: 15px;
      color: rgba(255, 255, 255, 0.85);
      line-height: 1.8;
    }
    
    .session-item {
      padding: 16px;
      border-left: 4px solid #DC143C;
      background: rgba(220, 20, 60, 0.1);
      backdrop-filter: blur(10px);
      margin-bottom: 16px;
      border-radius: 12px;
      transition: all 0.3s;
    }
    
    .session-item:hover {
      transform: translateX(8px);
      box-shadow: 0 8px 16px rgba(220, 20, 60, 0.3);
    }
    
    .session-item .date { 
      font-weight: 700; 
      color: #fff;
      font-size: 16px;
    }
    .session-item .trainer { 
      color: rgba(255, 255, 255, 0.7); 
      font-size: 14px;
      margin-top: 4px;
    }
    .session-item .part { 
      display: inline-block;
      background: linear-gradient(135deg, #DC143C 0%, #B22222 100%);
      color: white;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      margin-top: 8px;
      font-weight: 600;
    }
    .menu-list { 
      margin-top: 12px; 
      padding-left: 20px;
    }
    .menu-item { 
      font-size: 14px;
      color: rgba(255, 255, 255, 0.8);
      margin: 6px 0;
      line-height: 1.6;
    }
    
    .ai-text {
      white-space: pre-wrap;
      line-height: 1.8;
      color: rgba(255, 255, 255, 0.9);
      background: rgba(220, 20, 60, 0.1);
      backdrop-filter: blur(10px);
      padding: 24px;
      border-radius: 12px;
      border-left: 5px solid #DC143C;
      font-size: 15px;
    }
    
    .target-photo {
      max-width: 500px;
      border-radius: 16px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.5);
      margin: 20px 0;
      border: 3px solid #DC143C;
    }
    
    .ai-status {
      display: inline-block;
      padding: 8px 20px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 700;
      margin-bottom: 16px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .ai-status.success { background: #34C759; color: white; }
    .ai-status.error { background: #FF3B30; color: white; }
    .ai-status.pending { background: #FF9500; color: white; }
    
    .empty { 
      color: rgba(255, 255, 255, 0.5); 
      text-align: center; 
      padding: 60px 20px;
      font-size: 16px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="hero-section">
      <div class="hero-overlay">
        <div class="logo-container">
          <img src="https://drive.google.com/uc?export=view&id=1a2B3c4D5e6F7g8H9i0J" alt="ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼" class="trainer-photo">
<img src="https://drive.google.com/uc?export=view&id=9z8Y7x6W5v4U3t2S1r0Q" alt="Abody Logo" class="hero-logo">
        </div>
        <h1 class="hero-title">ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼å°‚ç”¨ã‚«ãƒ«ãƒ†ã‚·ã‚¹ãƒ†ãƒ </h1>
        <p class="hero-subtitle">ä¼šå“¡ã®é€²æ—ã‚’ç§‘å­¦çš„ã«ç®¡ç†ãƒ»åˆ†æ</p>
      </div>
    </div>
    
    <!-- åº—èˆ—é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="store-select-section">
      <div class="select-label">
        <span class="icon">ğŸ¢</span>
        <span>åº—èˆ—ã‚’é¸æŠ</span>
      </div>
      <div class="store-grid">
        <button class="store-btn" onclick="selectStore('ä¸Šé‡åº—')" data-store="ä¸Šé‡åº—">
          <div class="store-icon">ğŸ‹ï¸</div>
          <div class="store-name">ä¸Šé‡åº—</div>
        </button>
        <button class="store-btn" onclick="selectStore('æµæ¯”å¯¿åº—')" data-store="æµæ¯”å¯¿åº—">
          <div class="store-icon">ğŸ’ª</div>
          <div class="store-name">æµæ¯”å¯¿åº—</div>
        </button>
        <button class="store-btn" onclick="selectStore('æ¡œæœ¨ç”ºåº—')" data-store="æ¡œæœ¨ç”ºåº—">
          <div class="store-icon">ğŸŒ¸</div>
          <div class="store-name">æ¡œæœ¨ç”ºåº—</div>
        </button>
        <button class="store-btn" onclick="selectStore('ã‚ªãƒ³ãƒ©ã‚¤ãƒ³')" data-store="ã‚ªãƒ³ãƒ©ã‚¤ãƒ³">
          <div class="store-icon">ğŸ’»</div>
          <div class="store-name">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</div>
        </button>
        <button class="store-btn" onclick="selectStore('åœ¨å®…')" data-store="åœ¨å®…">
          <div class="store-icon">ğŸ </div>
          <div class="store-name">åœ¨å®…</div>
        </button>
      </div>
    </div>
    
    <!-- ä¼šå“¡é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    <div class="member-select-modern" id="memberSelectSection" style="display: none;">
      <div class="select-label">
        <span class="icon">ğŸ‘¤</span>
        <span>ä¼šå“¡ã‚’é¸æŠ</span>
        <span class="selected-store" id="selectedStoreLabel"></span>
      </div>
      <select id="memberSelect" class="modern-select">
        <option value="">ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
      </select>
    </div>
    
    <div id="content" style="display: none;">
      <div class="tabs">
        <button class="tab active" onclick="switchTab('ai2026')">ğŸ¯ 2026å¹´ç›®æ¨™</button>
        <button class="tab" onclick="switchTab('ideal')">ğŸ“Š ç†æƒ³å€¤åˆ†æ</button>
        <button class="tab" onclick="switchTab('bodyimages')">ğŸ“¸ ä½“ã®ç”»åƒè¨˜éŒ²</button>
        <button class="tab" onclick="switchTab('january-analysis')">ğŸ“ˆ 1æœˆåˆ†æãƒ»2æœˆææ¡ˆ</button>
        <button class="tab" onclick="switchTab('latest')">æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³</button>
        <button class="tab" onclick="switchTab('posture')">å§¿å‹¢è©•ä¾¡ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆAIï¼‰</button>
        <button class="tab" onclick="switchTab('history')">å±¥æ­´ä¸€è¦§</button>
        <button class="tab" onclick="switchTab('ratings')">ğŸŒŸ ä¼šå“¡è©•ä¾¡</button>
        <button class="tab training-form-btn" onclick="openTrainingForm()">
          <span style="font-size: 20px;">ğŸ“</span> ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å…¥åŠ›
        </button>
      </div>
      
      <!-- 2026å¹´ç›®æ¨™AI -->
      <div id="tab-ai2026" class="tab-content active">
        <div class="card">
          <h2>ğŸ¯ 2026å¹´ç›®æ¨™é”æˆãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—</h2>
          <div style="margin-bottom: 24px;">
            <h3 style="margin-bottom: 12px; color: #DC143C; font-size: 18px;">ğŸ“¸ ç›®æ¨™ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</h3>
            <input type="file" id="goal-photo-input" accept="image/*" style="display: none;" onchange="handleGoalPhotoSelect(event)">
            <button onclick="document.getElementById('goal-photo-input').click()" style="padding: 12px 24px; background: rgba(52, 199, 89, 0.2); border: 2px dashed #34C759; border-radius: 8px; color: #34C759; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
              ğŸ“· ç›®æ¨™ç”»åƒã‚’é¸æŠ
            </button>
            <div id="goal-photo-preview" style="margin-top: 16px;"></div>
            <div id="goal-photo-status" style="margin-top: 12px; font-size: 14px; color: rgba(255, 255, 255, 0.7);"></div>
          </div>
          <div style="margin-bottom: 24px;">
            <h3 style="margin-bottom: 12px; color: #DC143C; font-size: 18px;">ğŸ¤– AIåˆ†æã‚’å®Ÿè¡Œ</h3>
            <button id="run-goal-analysis-btn" onclick="runGoalAnalysis()" style="padding: 12px 24px; background: linear-gradient(135deg, #DC143C 0%, #B22222 100%); border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
              ğŸš€ AIåˆ†æã‚’å®Ÿè¡Œ
            </button>
            <div id="goal-analysis-status" style="margin-top: 12px; font-size: 14px; color: rgba(255, 255, 255, 0.7);"></div>
          </div>
          <div id="ai2026-content"></div>
          <div id="progress-plan-content"></div>
        </div>
      </div>
      
      <!-- ç†æƒ³å€¤åˆ†æ -->
      <div id="tab-ideal" class="tab-content">
        <div class="card">
          <h2>ğŸ“Š ç†æƒ³å€¤åˆ†æ</h2>
          <div id="ideal-content"></div>
        </div>
      </div>
      
      <!-- ä½“ã®ç”»åƒè¨˜éŒ² -->
      <div id="tab-bodyimages" class="tab-content">
        <div class="card">
          <h2>ğŸ“¸ ä½“ã®ç”»åƒè¨˜éŒ²</h2>
          <div id="photo-alert-content"></div>
          <button class="add-menu-btn" onclick="openBodyImageForm()" style="margin-bottom: 20px;">
            ğŸ“· æ–°ã—ã„ç”»åƒã‚’è¿½åŠ 
          </button>
          <div id="bodyimages-content"></div>
        </div>
      </div>
      
      <!-- 1æœˆåˆ†æãƒ»2æœˆææ¡ˆ -->
      <div id="tab-january-analysis" class="tab-content">
        <div class="card">
          <h2>ğŸ“Š 1æœˆåˆ†æãƒ»2æœˆææ¡ˆ</h2>
          <div style="margin-bottom: 24px;">
            <button onclick="runJanuaryAnalysis()" style="padding: 16px 32px; background: linear-gradient(135deg, #DC143C 0%, #B22222 100%); border: none; border-radius: 12px; color: white; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s;">
              ğŸš€ 1æœˆã®æˆé•·åˆ†æã¨2æœˆã®é€²ã‚æ–¹ã‚’ç”Ÿæˆ
            </button>
            <div id="january-analysis-status" style="margin-top: 12px; font-size: 14px; color: rgba(255, 255, 255, 0.7);"></div>
          </div>
          <div id="january-analysis-content"></div>
        </div>
      </div>
      
      <!-- æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³ -->
      <div id="tab-latest" class="tab-content">
        <div class="card">
          <h2>æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³</h2>
          <div id="latest-content"></div>
        </div>
      </div>
      
      <!-- å§¿å‹¢è©•ä¾¡ -->
      <div id="tab-posture" class="tab-content">
        <div class="card">
          <h2>å§¿å‹¢è©•ä¾¡ã‚¢ãƒ—ãƒ­ãƒ¼ãƒï¼ˆAIï¼‰</h2>
          <div style="margin-bottom: 24px;">
            <h3 style="margin-bottom: 12px; color: #DC143C; font-size: 18px;">âœï¸ æ‰‹å…¥åŠ›è©•ä¾¡</h3>
            <textarea id="posture-manual-input" class="form-textarea" rows="6" placeholder="å§¿å‹¢è©•ä¾¡ã‚’æ‰‹å…¥åŠ›ã§è¨˜éŒ²ã—ã¦ãã ã•ã„..."></textarea>
            <button onclick="savePostureManual()" style="margin-top: 12px; padding: 12px 24px; background: linear-gradient(135deg, #DC143C 0%, #B22222 100%); border: none; border-radius: 8px; color: white; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
              ğŸ’¾ ä¿å­˜
            </button>
          </div>
          <div id="posture-content"></div>
        </div>
      </div>
      
      <!-- å±¥æ­´ä¸€è¦§ -->
      <div id="tab-history" class="tab-content">
        <div class="card">
          <h2>ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å±¥æ­´ï¼ˆç›´è¿‘50ä»¶ï¼‰</h2>
          <div id="history-content"></div>
        </div>
      </div>
      
      <!-- ä¼šå“¡è©•ä¾¡ -->
      <div id="tab-ratings" class="tab-content">
        <div class="card">
          <h2>ğŸŒŸ ä¼šå“¡è©•ä¾¡ï¼ˆç›´è¿‘10ä»¶ï¼‰</h2>
          <div id="ratings-content"></div>
        </div>
      </div>
    </div>
    
    <!-- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å…¥åŠ›ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="trainingModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">ğŸ“ ä»Šæ—¥ã®ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å…¥åŠ›</h2>
          <button class="close-btn" onclick="closeTrainingForm()">&times;</button>
        </div>
        
        <form id="trainingForm" onsubmit="submitTrainingForm(event)">
          <!-- åŸºæœ¬æƒ…å ± -->
          <div class="form-section">
            <h3 class="section-title">ğŸ‘¤ åŸºæœ¬æƒ…å ±</h3>
            
            <div class="form-group">
              <label class="form-label">ä¼šå“¡ID</label>
              <input type="text" id="formMemberId" class="form-input" readonly>
            </div>
            
            <div class="form-group">
              <label class="form-label">ä¼šå“¡å</label>
              <input type="text" id="formMemberName" class="form-input" readonly>
            </div>
            
            <div class="form-group">
              <label class="form-label">åº—èˆ— <span class="required">*</span></label>
              <select id="formStore" class="form-select" required>
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="ä¸Šé‡åº—">ä¸Šé‡åº—</option>
                <option value="æµæ¯”å¯¿åº—">æµæ¯”å¯¿åº—</option>
                <option value="æ¡œæœ¨ç”ºåº—">æ¡œæœ¨ç”ºåº—</option>
                <option value="ã‚ªãƒ³ãƒ©ã‚¤ãƒ³">ã‚ªãƒ³ãƒ©ã‚¤ãƒ³</option>
                <option value="åœ¨å®…">åœ¨å®…</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">æ‹…å½“ãƒˆãƒ¬ãƒ¼ãƒŠãƒ¼ <span class="required">*</span></label>
              <select id="formTrainer" class="form-select" required>
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="ã¨ã‚‚ã">ã¨ã‚‚ã</option>
                <option value="ã²ã‚ã‚€">ã²ã‚ã‚€</option>
                <option value="ã ã„ã">ã ã„ã</option>
                <option value="ã‚†ã†ã”">ã‚†ã†ã”</option>
                <option value="ã²ã‚ã¨">ã²ã‚ã¨</option>
                <option value="ã›ã„ã‚„">ã›ã„ã‚„</option>
              </select>
            </div>
          </div>
          
          <!-- ä½“çµ„æˆãƒ‡ãƒ¼ã‚¿ -->
          <div class="form-section">
            <h3 class="section-title">âš–ï¸ ä½“çµ„æˆãƒ‡ãƒ¼ã‚¿ï¼ˆä»»æ„ï¼‰</h3>
            
            <div class="form-row">
              <div class="form-group">
                <label class="form-label">ä½“é‡ï¼ˆkgï¼‰</label>
                <input type="number" step="0.1" id="formWeight" class="form-input" placeholder="ä¾‹: 70.5">
              </div>
              
              <div class="form-group">
                <label class="form-label">ä½“è„‚è‚ªç‡ï¼ˆ%ï¼‰</label>
                <input type="number" step="0.1" id="formBodyFat" class="form-input" placeholder="ä¾‹: 15.5">
              </div>
            </div>
          </div>
          
          <!-- ä»Šæ—¥ã®ä½“èª¿ -->
          <div class="form-section">
            <h3 class="section-title">ğŸ¥ ä»Šæ—¥ã®ä½“èª¿</h3>
            
            <div class="form-group">
              <label class="form-label">ä½“èª¿</label>
              <select id="formCondition" class="form-select">
                <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                <option value="çµ¶å¥½èª¿">ğŸ˜„ çµ¶å¥½èª¿</option>
                <option value="è‰¯å¥½">ğŸ™‚ è‰¯å¥½</option>
                <option value="æ™®é€š">ğŸ˜ æ™®é€š</option>
                <option value="å°‘ã—ç–²ã‚Œ">ğŸ˜®â€ğŸ’¨ å°‘ã—ç–²ã‚Œ</option>
                <option value="ç–²åŠ´">ğŸ˜“ ç–²åŠ´</option>
                <option value="ä½“èª¿ä¸è‰¯">ğŸ¤’ ä½“èª¿ä¸è‰¯</option>
              </select>
            </div>
          </div>
          
          <!-- ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å†…å®¹ -->
          <div class="form-section">
            <h3 class="section-title">ğŸ’ª ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å†…å®¹</h3>
            
            <div class="form-group">
              <label class="form-label">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°éƒ¨ä½ï¼ˆè¤‡æ•°é¸æŠå¯ï¼‰ <span class="required">*</span></label>
              <div class="checkbox-grid">
                <label class="checkbox-label">
                  <input type="checkbox" name="bodyPart" value="èƒ¸" onchange="updateSelectedParts()">
                  <span>èƒ¸</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="bodyPart" value="èƒŒä¸­" onchange="updateSelectedParts()">
                  <span>èƒŒä¸­</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="bodyPart" value="è‚©" onchange="updateSelectedParts()">
                  <span>è‚©</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="bodyPart" value="è…•" onchange="updateSelectedParts()">
                  <span>è…•</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="bodyPart" value="è„š" onchange="updateSelectedParts()">
                  <span>è„š</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="bodyPart" value="è…¹ç­‹" onchange="updateSelectedParts()">
                  <span>è…¹ç­‹</span>
                </label>
                <label class="checkbox-label">
                  <input type="checkbox" name="bodyPart" value="æœ‰é…¸ç´ " onchange="updateSelectedParts()">
                  <span>æœ‰é…¸ç´ </span>
                </label>
              </div>
              <input type="hidden" id="formBodyPart" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">ã‚¹ãƒˆãƒ¬ãƒƒãƒ</label>
              <select id="formStretch" class="form-select">
                <option value="ã‚ã‚Š">ã‚ã‚Š</option>
                <option value="ãªã—">ãªã—</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">ã‚¹ãƒˆãƒ¬ãƒƒãƒå†…å®¹</label>
              <input type="text" id="formStretchContent" class="form-input" placeholder="ä¾‹: èƒ¸æ¤ã¨è‚©ç”²éª¨">
            </div>
            
            <div class="form-group">
              <label class="form-label">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚³ãƒ³ã‚»ãƒ—ãƒˆ</label>
              <textarea id="formConcept" class="form-textarea" rows="2" placeholder="ä¾‹: å¤§èƒ¸ç­‹ã®ä¸Šéƒ¨ã‚’é‡ç‚¹çš„ã«ã€‚ãƒ•ã‚©ãƒ¼ãƒ æ”¹å–„ã«é›†ä¸­ã€‚"></textarea>
            </div>
            
            <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼1-5 -->
            <div id="menuContainer"></div>
            
            <button type="button" class="add-menu-btn" onclick="addMenu()">
              â• ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’è¿½åŠ 
            </button>
          </div>
          
          <!-- ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ² -->
          <div class="form-section">
            <h3 class="section-title">ğŸ’¬ ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨˜éŒ²</h3>
            
            <div class="form-group">
              <label class="form-label">è‰¯ã‹ã£ãŸç‚¹</label>
              <textarea id="formGoodPoints" class="form-textarea" rows="3" placeholder="ä¾‹: èƒ¸ã®å¼µã‚ŠãŒè‰¯ããªã£ãŸ"></textarea>
            </div>
            
            <div class="form-group">
              <label class="form-label">æ”¹å–„ç‚¹ã‚„æ°—ä»˜ã</label>
              <textarea id="formImprovements" class="form-textarea" rows="3" placeholder="ä¾‹: èƒ¸æ¤ç¡¬ã„ã€è‚©ç”²éª¨ã®ã‹ã›"></textarea>
            </div>
            
            <div class="form-group">
              <label class="form-label">ç—›ã¿ã‚„é•å’Œæ„Ÿ</label>
              <select id="formPain" class="form-select">
                <option value="ãªã—">ãªã—</option>
                <option value="ã‚ã‚Š">ã‚ã‚Š</option>
              </select>
            </div>
            
            <div class="form-group">
              <label class="form-label">ä¼šè©±ãƒ»ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å†…å®¹</label>
              <textarea id="formConversation" class="form-textarea" rows="4" placeholder="ä»Šæ—¥è©±ã—ãŸå†…å®¹ã‚„ä¼šå“¡ã®çŠ¶æ…‹ã€æ°—ã¥ã„ãŸç‚¹ãªã©ã‚’è¨˜éŒ²ã—ã¦ãã ã•ã„ã€‚"></textarea>
            </div>
          </div>
          
          <button type="submit" class="form-submit">ğŸ’¾ è¨˜éŒ²ã‚’ä¿å­˜ã™ã‚‹</button>
        </form>
      </div>
    </div>
    
    <!-- ä½“ã®ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="bodyImageModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title">ğŸ“· ä½“ã®ç”»åƒã‚’è¨˜éŒ²</h2>
          <button class="close-btn" onclick="closeBodyImageForm()">&times;</button>
        </div>
        
        <form id="bodyImageForm" onsubmit="submitBodyImageForm(event)">
          <div class="form-section">
            <h3 class="section-title">ğŸ“… æ’®å½±æƒ…å ±</h3>
            
            <div class="form-group">
              <label class="form-label">ä¼šå“¡ID</label>
              <input type="text" id="bodyImageMemberId" class="form-input" readonly>
            </div>
            
            <div class="form-group">
              <label class="form-label">ä¼šå“¡å</label>
              <input type="text" id="bodyImageMemberName" class="form-input" readonly>
            </div>
            
            <div class="form-group">
              <label class="form-label">æ’®å½±æ—¥ <span class="required">*</span></label>
              <input type="date" id="bodyImageDate" class="form-input" required>
            </div>
            
            <div class="form-group">
              <label class="form-label">ãƒ¡ãƒ¢ï¼ˆä»»æ„ï¼‰</label>
              <textarea id="bodyImageMemo" class="form-textarea" rows="2" placeholder="ä¾‹: 3ãƒ¶æœˆç›®ã®è¨˜éŒ²ã€ä½“é‡-2kg"></textarea>
            </div>
          </div>
          
          <div class="form-section">
            <h3 class="section-title">ğŸ“¸ ç”»åƒï¼ˆæœ€å¤§3æšï¼‰</h3>
            
            <div class="form-group">
              <label class="form-label">ç”»åƒ1 <span class="required">*</span></label>
              <input type="file" id="bodyImage1" class="form-input" accept="image/*" required onchange="previewImage(this, 'preview1')">
              <div id="preview1" style="margin-top: 10px;"></div>
            </div>
            
            <div class="form-group">
              <label class="form-label">ç”»åƒ2ï¼ˆä»»æ„ï¼‰</label>
              <input type="file" id="bodyImage2" class="form-input" accept="image/*" onchange="previewImage(this, 'preview2')">
              <div id="preview2" style="margin-top: 10px;"></div>
            </div>
            
            <div class="form-group">
              <label class="form-label">ç”»åƒ3ï¼ˆä»»æ„ï¼‰</label>
              <input type="file" id="bodyImage3" class="form-input" accept="image/*" onchange="previewImage(this, 'preview3')">
              <div id="preview3" style="margin-top: 10px;"></div>
            </div>
          </div>
          
          <button type="submit" class="form-submit">ğŸ’¾ ç”»åƒã‚’ä¿å­˜ã™ã‚‹</button>
        </form>
      </div>
    </div>
  </div>

  <script>
    let currentTab = 'ai2026';
    let selectedStore = '';
    let currentMemberId = '';
    let currentMemberName = '';
    
    // éƒ¨ä½åˆ¥ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆè¶³ãƒˆãƒ¬ã«ãŠå°»ã®ç¨®ç›®ã‚’è¿½åŠ ï¼‰
    const trainingMenus = {
      'èƒ¸': [
        'ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹', 'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹', 'ãƒ‡ã‚¯ãƒ©ã‚¤ãƒ³ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹',
        'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹', 'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ãƒ—ãƒ¬ã‚¹', 'ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤',
        'ã‚¤ãƒ³ã‚¯ãƒ©ã‚¤ãƒ³ãƒ€ãƒ³ãƒ™ãƒ«ãƒ•ãƒ©ã‚¤', 'ã‚±ãƒ¼ãƒ–ãƒ«ã‚¯ãƒ­ã‚¹ã‚ªãƒ¼ãƒãƒ¼', 'ãƒã‚§ã‚¹ãƒˆãƒ—ãƒ¬ã‚¹ãƒã‚·ãƒ³',
        'ãƒšãƒƒã‚¯ãƒ•ãƒ©ã‚¤ãƒã‚·ãƒ³', 'ãƒ‡ã‚£ãƒƒãƒ—ã‚¹', 'ãƒ—ãƒƒã‚·ãƒ¥ã‚¢ãƒƒãƒ—', 'ãã®ä»–'
      ],
      'èƒŒä¸­': [
        'ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ', 'ãƒ™ãƒ³ãƒˆã‚ªãƒ¼ãƒãƒ¼ãƒ­ã‚¦', 'ãƒ¯ãƒ³ãƒãƒ³ãƒ‰ãƒ­ã‚¦',
        'ãƒ©ãƒƒãƒˆãƒ—ãƒ«ãƒ€ã‚¦ãƒ³', 'ãƒãƒ³ãƒ‹ãƒ³ã‚°ï¼ˆæ‡¸å‚ï¼‰', 'ã‚·ãƒ¼ãƒ†ãƒƒãƒ‰ãƒ­ã‚¦',
        'Tãƒãƒ¼ãƒ­ã‚¦', 'ã‚±ãƒ¼ãƒ–ãƒ«ãƒ­ã‚¦', 'ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆã‚¢ãƒ¼ãƒ ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³',
        'ãƒ•ã‚§ã‚¤ã‚¹ãƒ—ãƒ«', 'ãƒãƒƒã‚¯ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³', 'ãã®ä»–'
      ],
      'è‚©': [
        'ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹', 'ãƒ€ãƒ³ãƒ™ãƒ«ã‚·ãƒ§ãƒ«ãƒ€ãƒ¼ãƒ—ãƒ¬ã‚¹', 'ã‚¢ãƒ¼ãƒãƒ«ãƒ‰ãƒ—ãƒ¬ã‚¹',
        'ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º', 'ãƒ•ãƒ­ãƒ³ãƒˆãƒ¬ã‚¤ã‚º', 'ãƒªã‚¢ãƒ¬ã‚¤ã‚º',
        'ã‚±ãƒ¼ãƒ–ãƒ«ã‚µã‚¤ãƒ‰ãƒ¬ã‚¤ã‚º', 'ã‚¢ãƒƒãƒ—ãƒ©ã‚¤ãƒˆãƒ­ã‚¦', 'ã‚·ãƒ¥ãƒ©ãƒƒã‚°',
        'ãƒ•ã‚§ã‚¤ã‚¹ãƒ—ãƒ«', 'ãã®ä»–'
      ],
      'è…•': [
        'ãƒãƒ¼ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«', 'ãƒ€ãƒ³ãƒ™ãƒ«ã‚«ãƒ¼ãƒ«', 'ãƒãƒ³ãƒãƒ¼ã‚«ãƒ¼ãƒ«',
        'ã‚³ãƒ³ã‚»ãƒ³ãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚«ãƒ¼ãƒ«', 'ãƒ—ãƒªãƒ¼ãƒãƒ£ãƒ¼ã‚«ãƒ¼ãƒ«', 'ã‚±ãƒ¼ãƒ–ãƒ«ã‚«ãƒ¼ãƒ«',
        'ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ãƒ—ãƒƒã‚·ãƒ¥ãƒ€ã‚¦ãƒ³', 'ãƒˆãƒ©ã‚¤ã‚»ãƒ—ã‚¹ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³', 'ãƒ•ãƒ¬ãƒ³ãƒãƒ—ãƒ¬ã‚¹',
        'ãƒ‡ã‚£ãƒƒãƒ—ã‚¹', 'ã‚¯ãƒ­ãƒ¼ã‚ºã‚°ãƒªãƒƒãƒ—ãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹', 'ã‚­ãƒƒã‚¯ãƒãƒƒã‚¯', 'ãã®ä»–'
      ],
      'è„š': [
        'ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', 'ãƒ•ãƒ­ãƒ³ãƒˆã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', 'ãƒ–ãƒ«ã‚¬ãƒªã‚¢ãƒ³ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ',
        'ãƒ¯ã‚¤ãƒ‰ã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', 'ã‚´ãƒ–ãƒ¬ãƒƒãƒˆã‚¹ã‚¯ãƒ¯ãƒƒãƒˆ', 'ãƒ¬ãƒƒã‚°ãƒ—ãƒ¬ã‚¹',
        'ãƒ¬ãƒƒã‚°ã‚¨ã‚¯ã‚¹ãƒ†ãƒ³ã‚·ãƒ§ãƒ³', 'ãƒ¬ãƒƒã‚°ã‚«ãƒ¼ãƒ«', 'ãƒ«ãƒ¼ãƒãƒ‹ã‚¢ãƒ³ãƒ‡ãƒƒãƒ‰ãƒªãƒ•ãƒˆ',
        'ãƒ¬ãƒƒã‚°ã‚¢ãƒ€ã‚¯ã‚·ãƒ§ãƒ³', 'ãƒ¬ãƒƒã‚°ã‚¢ãƒ–ãƒ€ã‚¯ã‚·ãƒ§ãƒ³', 'ã‚«ãƒ¼ãƒ•ãƒ¬ã‚¤ã‚º', 'ãƒ©ãƒ³ã‚¸',
        'ãƒ’ãƒƒãƒ—ã‚¹ãƒ©ã‚¹ãƒˆ', 'ã‚°ãƒ«ãƒ¼ãƒˆãƒ–ãƒªãƒƒã‚¸', 'ã‚¯ãƒ©ãƒ ã‚·ã‚§ãƒ«',
        'ãƒ‰ãƒ³ã‚­ãƒ¼ã‚­ãƒƒã‚¯', 'ãƒ•ã‚¡ã‚¤ã‚¢ãƒã‚¤ãƒ‰ãƒ©ãƒ³ãƒˆ', 'ãã®ä»–'
      ],
      'è…¹ç­‹': [
        'ã‚¯ãƒ©ãƒ³ãƒ', 'ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º', 'ãƒ—ãƒ©ãƒ³ã‚¯',
        'ã‚µã‚¤ãƒ‰ãƒ—ãƒ©ãƒ³ã‚¯', 'ãƒã‚¤ã‚·ã‚¯ãƒ«ã‚¯ãƒ©ãƒ³ãƒ', 'ãƒ­ã‚·ã‚¢ãƒ³ãƒ„ã‚¤ã‚¹ãƒˆ',
        'ãƒãƒ³ã‚®ãƒ³ã‚°ãƒ¬ãƒƒã‚°ãƒ¬ã‚¤ã‚º', 'ã‚¢ãƒ–ãƒ­ãƒ¼ãƒ©ãƒ¼', 'ã‚±ãƒ¼ãƒ–ãƒ«ã‚¯ãƒ©ãƒ³ãƒ',
        'ãƒã‚¦ãƒ³ãƒ†ãƒ³ã‚¯ãƒ©ã‚¤ãƒãƒ¼', 'ãã®ä»–'
      ],
      'æœ‰é…¸ç´ ': [
        'ãƒˆãƒ¬ãƒƒãƒ‰ãƒŸãƒ«', 'ã‚¨ã‚¢ãƒ­ãƒã‚¤ã‚¯', 'ãƒ­ãƒ¼ã‚¤ãƒ³ã‚°ãƒã‚·ãƒ³',
        'ã‚¹ãƒ†ã‚¢ãƒã‚¹ã‚¿ãƒ¼', 'ã‚¨ãƒªãƒ—ãƒ†ã‚£ã‚«ãƒ«', 'ãƒ©ãƒ³ãƒ‹ãƒ³ã‚°',
        'ã‚¦ã‚©ãƒ¼ã‚­ãƒ³ã‚°', 'HIIT', 'ãã®ä»–'
      ]
    };
    
    // æ™‚é–“ãƒ™ãƒ¼ã‚¹ï¼ˆç§’æ•°ï¼‰ã®ç¨®ç›®ãƒªã‚¹ãƒˆ
    const timeBasedExercises = [
      'ãƒ—ãƒ©ãƒ³ã‚¯', 'ã‚µã‚¤ãƒ‰ãƒ—ãƒ©ãƒ³ã‚¯', 'ãƒ›ãƒ­ãƒ¼ãƒ›ãƒ¼ãƒ«ãƒ‰',
      'ãƒ‡ãƒƒãƒ‰ãƒãƒ³ã‚°', 'Lã‚·ãƒƒãƒˆ', 'ã‚¦ã‚©ãƒ¼ãƒ«ã‚·ãƒƒãƒˆ',
      'ã‚°ãƒ«ãƒ¼ãƒˆãƒ–ãƒªãƒƒã‚¸ãƒ›ãƒ¼ãƒ«ãƒ‰', 'ã‚¢ã‚¤ã‚½ãƒ¡ãƒˆãƒªãƒƒã‚¯ãƒ›ãƒ¼ãƒ«ãƒ‰'
    ];
    
    // é‡é‡ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ0.5kgåˆ»ã¿ + é‡ã•ãªã—/è‡ªé‡ï¼‰
    function generateWeightOptions() {
      const weights = ['é¸æŠ', 'é‡ã•ãªã—', 'è‡ªé‡'];
      for (let i = 0.5; i <= 200; i += 0.5) {
        weights.push(i + 'kg');
      }
      return weights;
    }
    
    // å›æ•°ã‚ªãƒ—ã‚·ãƒ§ãƒ³
    function generateRepsOptions() {
      const reps = ['é¸æŠ'];
      for (let i = 1; i <= 100; i++) {
        reps.push(i + 'å›');
      }
      return reps;
    }
    
    // ç§’æ•°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆ5ç§’åˆ»ã¿ã§300ç§’ã¾ã§ï¼‰
    function generateTimeOptions() {
      const times = ['é¸æŠ'];
      for (let i = 5; i <= 300; i += 5) {
        times.push(i + 'ç§’');
      }
      return times;
    }
    
    // ç¨®ç›®ãŒæ™‚é–“ãƒ™ãƒ¼ã‚¹ã‹ãƒã‚§ãƒƒã‚¯
    function isTimeBasedExercise(exerciseName) {
      return timeBasedExercises.some(ex => exerciseName.includes(ex));
    }
    
    // éƒ¨ä½é¸æŠã‚’æ›´æ–°
    function updateSelectedParts() {
      const checkboxes = document.querySelectorAll('input[name="bodyPart"]:checked');
      const selected = Array.from(checkboxes).map(cb => cb.value);
      document.getElementById('formBodyPart').value = selected.join('ã€');
    }
    
    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¿½åŠ æ©Ÿèƒ½
    let menuCount = 0;
    const maxMenus = 5;
    
    function addMenu() {
      if (menuCount >= maxMenus) {
        alert('ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¯æœ€å¤§5ã¤ã¾ã§ã§ã™');
        return;
      }
      
      menuCount++;
      const menuId = menuCount;
      
      // é¸æŠã•ã‚ŒãŸéƒ¨ä½ã‚’å–å¾—
      const checkboxes = document.querySelectorAll('input[name="bodyPart"]:checked');
      const selectedParts = Array.from(checkboxes).map(cb => cb.value);
      
      // å…¨ã¦ã®éƒ¨ä½ã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’çµ±åˆ
      let allMenus = [];
      selectedParts.forEach(part => {
        if (trainingMenus[part]) {
          allMenus = allMenus.concat(trainingMenus[part]);
        }
      });
      
      // é‡è¤‡ã‚’å‰Šé™¤
      allMenus = [...new Set(allMenus)];
      
      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
      let menuOptions = '<option value="">é¸æŠã—ã¦ãã ã•ã„</option>';
      allMenus.forEach(menu => {
        menuOptions += `<option value="${menu}">${menu}</option>`;
      });
      
      // é‡é‡ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
      const weightOpts = generateWeightOptions();
      
      // å›æ•°ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ç”Ÿæˆ
      const repsOpts = generateRepsOptions();
      
      const menuHtml = `
        <div class="menu-group" id="menu-${menuId}">
          <div style="display: flex; justify-content: space-between; align-items: center;">
            <h4 class="menu-title">ãƒ¡ãƒ‹ãƒ¥ãƒ¼${menuId}</h4>
            <button type="button" class="remove-menu-btn" onclick="removeMenu(${menuId})" style="width: auto; padding: 6px 12px; margin: 0;">
              âœ• å‰Šé™¤
            </button>
          </div>
          
          <div class="form-group">
            <label class="form-label">ç¨®ç›®</label>
            <select id="formMenuName${menuId}" class="form-select">
              ${menuOptions}
            </select>
          </div>
          
          <div class="form-group">
            <label class="form-label">ã‚»ãƒƒãƒˆæ•°</label>
            <select id="formSetCount${menuId}" class="form-select">
              <option value="">é¸æŠ</option>
              <option value="1">1ã‚»ãƒƒãƒˆ</option>
              <option value="2">2ã‚»ãƒƒãƒˆ</option>
              <option value="3">3ã‚»ãƒƒãƒˆ</option>
              <option value="4">4ã‚»ãƒƒãƒˆ</option>
              <option value="5">5ã‚»ãƒƒãƒˆ</option>
            </select>
          </div>
          
          <div id="setDetails${menuId}"></div>
        </div>
      `;
      
      document.getElementById('menuContainer').insertAdjacentHTML('beforeend', menuHtml);
      
      // ã‚»ãƒƒãƒˆæ•°å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
      document.getElementById(`formSetCount${menuId}`).addEventListener('change', function() {
        updateSetDetails(menuId, parseInt(this.value) || 0);
      });
      
      // ç¨®ç›®å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ ï¼ˆå›æ•°/ç§’æ•°ã‚’åˆ‡ã‚Šæ›¿ãˆï¼‰
      document.getElementById(`formMenuName${menuId}`).addEventListener('change', function() {
        const currentSetCount = parseInt(document.getElementById(`formSetCount${menuId}`).value) || 0;
        if (currentSetCount > 0) {
          updateSetDetails(menuId, currentSetCount);
        }
      });
    }
    
    function removeMenu(menuId) {
      document.getElementById(`menu-${menuId}`).remove();
      menuCount--;
    }
    
    function updateSetDetails(menuId, setCount) {
      const container = document.getElementById(`setDetails${menuId}`);
      container.innerHTML = '';
      
      // é¸æŠã•ã‚ŒãŸç¨®ç›®ã‚’å–å¾—
      const selectedExercise = document.getElementById(`formMenuName${menuId}`)?.value || '';
      const isTimeBased = isTimeBasedExercise(selectedExercise);
      
      const weightOpts = generateWeightOptions();
      const repsOpts = isTimeBased ? generateTimeOptions() : generateRepsOptions();
      const repsLabel = isTimeBased ? 'ç§’æ•°' : 'å›æ•°';
      
      for (let i = 1; i <= setCount; i++) {
        let weightOptions = '';
        weightOpts.forEach(w => {
          weightOptions += `<option value="${w}">${w}</option>`;
        });
        
        let repsOptions = '';
        repsOpts.forEach(r => {
          repsOptions += `<option value="${r}">${r}</option>`;
        });
        
        const setHtml = `
          <div class="menu-group" style="margin-top: 12px; padding: 16px; background: rgba(255, 255, 255, 0.02);">
            <h5 style="font-size: 14px; color: rgba(255, 255, 255, 0.8); margin-bottom: 12px;">ç¬¬${i}ã‚»ãƒƒãƒˆ</h5>
            <div class="set-inputs">
              <div class="set-input-group">
                <label class="set-input-label">é‡é‡</label>
                <select id="formWeight${menuId}_${i}" class="form-select">
                  ${weightOptions}
                </select>
              </div>
              <div class="set-input-group">
                <label class="set-input-label">${repsLabel}</label>
                <select id="formReps${menuId}_${i}" class="form-select">
                  ${repsOptions}
                </select>
              </div>
            </div>
          </div>
        `;
        container.insertAdjacentHTML('beforeend', setHtml);
      }
    }
    
    // åˆæœŸåŒ–
    window.onload = function() {
      // ä¼šå“¡ãƒªã‚¹ãƒˆã¯åº—èˆ—é¸æŠå¾Œã«èª­ã¿è¾¼ã‚€
    };
    
    // åº—èˆ—é¸æŠï¼ˆlocalStorageã«ä¿å­˜ã—ãªã„ï¼‰
    function selectStore(store) {
      selectedStore = store;
      
      console.log('Store selected:', store);
      
      // ã™ã¹ã¦ã®åº—èˆ—ãƒœã‚¿ãƒ³ã‹ã‚‰ selected ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤
      document.querySelectorAll('.store-btn').forEach(btn => {
        btn.classList.remove('selected');
      });
      
      // é¸æŠã—ãŸåº—èˆ—ãƒœã‚¿ãƒ³ã« selected ã‚¯ãƒ©ã‚¹ã‚’è¿½åŠ 
      event.target.closest('.store-btn').classList.add('selected');
      
      // é¸æŠã—ãŸåº—èˆ—ã‚’è¡¨ç¤º
      document.getElementById('selectedStoreLabel').textContent = `ï¼ˆ${store}ï¼‰`;
      
      // ä¼šå“¡é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
      document.getElementById('memberSelectSection').style.display = 'block';
      
      // ä¼šå“¡ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãªã— - ã™ã¹ã¦ã®ä¼šå“¡ã‚’è¡¨ç¤ºï¼‰
      loadMembers(store);
      
      // ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      setTimeout(() => {
        document.getElementById('memberSelectSection').scrollIntoView({ 
          behavior: 'smooth', 
          block: 'center' 
        });
      }, 100);
    }
    
    // ä¼šå“¡ä¸€è¦§èª­ã¿è¾¼ã¿ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãªã—ï¼‰
    function loadMembers(store) {
      console.log('Loading members for store:', store);
      
      const select = document.getElementById('memberSelect');
      select.innerHTML = '<option value="">èª­ã¿è¾¼ã¿ä¸­...</option>';
      
      google.script.run
        .withSuccessHandler(function(members) {
          console.log('Members loaded:', members);
          
          select.innerHTML = '<option value="">ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„</option>';
          
          if (!members || members.length === 0) {
            select.innerHTML = '<option value="">ä¼šå“¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>';
            console.error('No members found');
            return;
          }
          
          // ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’å‰Šé™¤ - ã™ã¹ã¦ã®ä¼šå“¡ã‚’è¡¨ç¤º
          const filteredMembers = members;
          
          console.log('All members displayed:', filteredMembers.length);
          
          if (filteredMembers.length === 0) {
            select.innerHTML = `<option value="">ä¼šå“¡ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</option>`;
            return;
          }
          
          filteredMembers.forEach(m => {
            const option = document.createElement('option');
            option.value = m.id;
            option.textContent = m.display;
            option.dataset.name = m.name;
            select.appendChild(option);
          });
          
          console.log('Member select populated with', filteredMembers.length, 'members');
        })
        .withFailureHandler(function(error) {
          console.error('Error loading members:', error);
          alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
          select.innerHTML = '<option value="">ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</option>';
        })
        .tw_api_getMembers();
    }
    
    // ä¼šå“¡é¸æŠ
    document.getElementById('memberSelect').addEventListener('change', function() {
      const memberId = this.value;
      currentMemberId = memberId;
      
      if (!memberId) {
        document.getElementById('content').style.display = 'none';
        return;
      }
      
      // é¸æŠã—ãŸä¼šå“¡ã®åå‰ã‚’ä¿å­˜
      const selectedOption = this.options[this.selectedIndex];
      currentMemberName = selectedOption.dataset.name || selectedOption.textContent;
      
      document.getElementById('content').style.display = 'block';
      loadSummary(memberId);
      
      // ã‚¹ãƒ ãƒ¼ã‚ºã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
      document.getElementById('content').scrollIntoView({ 
        behavior: 'smooth', 
        block: 'start' 
      });
    });
    
    // ã‚µãƒãƒªãƒ¼èª­ã¿è¾¼ã¿
    function loadSummary(memberId) {
      console.log('=== loadSummary called for member:', memberId);
      
      google.script.run
        .withSuccessHandler(function(result) {
          console.log('=== getSummary raw response:', result);
          console.log('Result type:', typeof result);
          console.log('Result keys:', Object.keys(result));
          
          if (!result || typeof result !== 'object') {
            console.error('Invalid result object');
            alert('ã‚¨ãƒ©ãƒ¼: ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            return;
          }
          
          if (result.ok === false) {
            console.error('Result.ok is false:', result.message);
            alert('ã‚¨ãƒ©ãƒ¼: ' + result.message);
            return;
          }
          
          console.log('Body images type:', typeof result.bodyImages);
          console.log('Body images length:', result.bodyImages ? result.bodyImages.length : 'undefined');
          console.log('Body images data:', JSON.stringify(result.bodyImages));
          console.log('Photo alert:', JSON.stringify(result.photoAlert));
          
          // ãƒ‡ãƒ¼ã‚¿ã‚’é †ç•ªã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
          console.log('Rendering latest...');
          renderLatest(result.latest);
          
          console.log('Rendering posture...');
          renderPosture(result.posture, result.postureManual);
          
          console.log('Rendering ai2026...');
          renderAi2026(result.ai2026, result.idealMetrics, result.progressPlan);
          
          console.log('Rendering ideal metrics...');
          renderIdealMetrics(result.idealMetrics, result.ai2026);
          
          console.log('Rendering history...');
          renderHistory(result.history);
          
          console.log('Rendering body images...');
          renderBodyImages(result.bodyImages, result.photoAlert);
          
          console.log('Rendering ratings...');
          renderRatings(result.ratings);
          
          console.log('=== All rendering completed ===');
        })
        .withFailureHandler(function(error) {
          console.error('getSummary error:', error);
          console.error('Error type:', typeof error);
          console.error('Error message:', error.message);
          console.error('Error stack:', error.stack);
          alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
        })
        .tw_api_getSummary(memberId);
    }
    /**
 * Google Driveã®URLã‚’ç”»åƒè¡¨ç¤ºç”¨URLã«å¤‰æ›ï¼ˆè¤‡æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³å¯¾å¿œï¼‰
 */
function convertDriveUrl(url) {
  if (!url) return '';
  
  console.log('Original URL:', url);
  
  let fileId = null;
  
  // ãƒ‘ã‚¿ãƒ¼ãƒ³1: /file/d/FILE_ID/view å½¢å¼
  let match = url.match(/\/file\/d\/([^\/\?]+)/);
  if (match && match[1]) {
    fileId = match[1];
  }
  
  // ãƒ‘ã‚¿ãƒ¼ãƒ³2: /open?id=FILE_ID å½¢å¼
  if (!fileId) {
    match = url.match(/\/open\?id=([^&]+)/);
    if (match && match[1]) {
      fileId = match[1];
    }
  }
  
  // ãƒ‘ã‚¿ãƒ¼ãƒ³3: ?id=FILE_ID ã¾ãŸã¯ &id=FILE_ID å½¢å¼
  if (!fileId) {
    match = url.match(/[?&]id=([^&]+)/);
    if (match && match[1]) {
      fileId = match[1];
    }
  }
  
  // ãƒ‘ã‚¿ãƒ¼ãƒ³4: /uc?export=view&id=FILE_ID å½¢å¼
  if (!fileId) {
    match = url.match(/\/uc\?[^&]*id=([^&]+)/);
    if (match && match[1]) {
      fileId = match[1];
    }
  }
  
  // ãƒ‘ã‚¿ãƒ¼ãƒ³5: ç›´æ¥ãƒ•ã‚¡ã‚¤ãƒ«IDãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼ˆ32æ–‡å­—ã®è‹±æ•°å­—ï¼‰
  if (!fileId) {
    match = url.match(/([a-zA-Z0-9_-]{32,})/);
    if (match && match[1]) {
      fileId = match[1];
    }
  }
  
  if (fileId) {
    // ã‚µãƒ ãƒã‚¤ãƒ«URLã«å¤‰æ›ï¼ˆæœ€å¤§ã‚µã‚¤ã‚ºæŒ‡å®šï¼‰
    const convertedUrl = `https://drive.google.com/thumbnail?id=${fileId}&sz=w1000`;
    console.log('Converted to thumbnail URL:', convertedUrl);
    return convertedUrl;
  }
  
  console.log('URL not converted, using original');
  return url;
}
    
    function renderBodyImages(images, photoAlert) {
      console.log('=== renderBodyImages called ===');
      console.log('Images:', images);
      console.log('Photo alert:', photoAlert);
      
      const alertEl = document.getElementById('photo-alert-content');
      const contentEl = document.getElementById('bodyimages-content');
      
      if (!alertEl || !contentEl) {
        console.error('Elements not found!');
        return;
      }
      
      // ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º
      if (photoAlert && photoAlert.hasAlert) {
        alertEl.innerHTML = `
          <div class="info-box" style="background: rgba(255, 59, 48, 0.1); border-left-color: #FF3B30;">
            <div class="title" style="color: #FF3B30;">âš ï¸ æ’®å½±æ¨å¥¨</div>
            <div class="content">${photoAlert.message}</div>
          </div>
        `;
      } else if (photoAlert && photoAlert.lastPhotoDate) {
        alertEl.innerHTML = `
          <div class="info-box" style="background: rgba(52, 199, 89, 0.1); border-left-color: #34C759;">
            <div class="title" style="color: #34C759;">âœ… æ’®å½±è¨˜éŒ²ã‚ã‚Š</div>
            <div class="content">${photoAlert.message}</div>
          </div>
        `;
      } else {
        alertEl.innerHTML = '';
      }
      
      // ç”»åƒè¡¨ç¤º
      if (!images || images.length === 0) {
        console.log('No images to display');
        contentEl.innerHTML = '<div class="empty">ã¾ã ç”»åƒãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“</div>';
        return;
      }
      
      console.log('Rendering', images.length, 'image records');
      
      let html = '<div style="display: grid; gap: 24px;">';
      
      images.forEach((record, index) => {
        console.log('Rendering record', index, ':', record);
        
        // å‰Šé™¤ç”¨ã®æ—¥ä»˜ï¼ˆdateRawã‚’å„ªå…ˆã€ãªã‘ã‚Œã°dateã‚’æ–‡å­—åˆ—ã¨ã—ã¦ä½¿ç”¨ï¼‰
        const shootingDate = record.dateRaw || (typeof record.date === 'string' ? `'${record.date}'` : record.date);
        
        html += `
          <div class="card" style="padding: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
              <h3 style="margin: 0; color: #DC143C;">
                ğŸ“… ${record.date}
                ${record.memo ? `<span style="font-size: 14px; color: #999; margin-left: 12px;">${record.memo}</span>` : ''}
              </h3>
              <button onclick="deleteBodyImageRecord('${currentMemberId}', ${shootingDate})" 
                      style="background: #FF3B30; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 14px;"
                      onmouseover="this.style.background='#FF6B60'" 
                      onmouseout="this.style.background='#FF3B30'">
                å‰Šé™¤
              </button>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 12px; @media (max-width: 768px) { grid-template-columns: 1fr; }">
        `;
        
        record.urls.forEach((url, imgIndex) => {
          const imageUrl = convertDriveUrl(url);
          // URLã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆã‚·ãƒ³ã‚°ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã¨ãƒ€ãƒ–ãƒ«ã‚¯ã‚©ãƒ¼ãƒˆã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
          const escapedUrl = url.replace(/'/g, "\\'").replace(/"/g, '&quot;');
          const escapedImageUrl = imageUrl.replace(/'/g, "\\'").replace(/"/g, '&quot;');
          
          html += `
            <div style="position: relative; aspect-ratio: 3/4; overflow: hidden; border-radius: 12px; border: 2px solid #DC143C; background: rgba(255,255,255,0.05); min-height: 200px;">
              <img src="${escapedImageUrl}" alt="ä½“ã®å†™çœŸ ${imgIndex + 1}" 
                   style="width: 100%; height: 100%; object-fit: cover; cursor: pointer; display: block;"
                   onerror="console.error('ç”»åƒèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', '${escapedImageUrl}'); this.style.display='none'; const errorDiv = this.nextElementSibling; if(errorDiv) errorDiv.style.display='flex';"
                   onclick="window.open('${escapedUrl}', '_blank')"
                   loading="lazy">
              <div style="display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; align-items: center; justify-content: center; flex-direction: column; padding: 16px; text-align: center; color: #999; font-size: 14px; background: rgba(0,0,0,0.7);">
                <div style="margin-bottom: 8px; font-size: 16px;">âš ï¸ ç”»åƒã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“</div>
                <a href="${escapedUrl}" target="_blank" style="color: #DC143C; text-decoration: underline; font-size: 14px; padding: 8px 16px; background: rgba(220,20,60,0.2); border-radius: 8px;">å…ƒã®URLã‚’é–‹ã</a>
              </div>
            </div>
          `;
        });
        
        html += `
            </div>
          </div>
        `;
      });
      
      html += '</div>';
      contentEl.innerHTML = html;
      
      console.log('=== renderBodyImages completed ===');
    }
    
    // ä½“ã®ç”»åƒè¨˜éŒ²ã‚’å‰Šé™¤
    function deleteBodyImageRecord(memberId, shootingDate) {
      if (!memberId || !shootingDate) {
        alert('å‰Šé™¤ã«å¿…è¦ãªæƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã¾ã™');
        return;
      }
      
      if (!confirm('ã“ã®ç”»åƒè¨˜éŒ²ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ\nï¼ˆDriveãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã¯å‰Šé™¤ã•ã‚Œã¾ã›ã‚“ï¼‰')) {
        return;
      }
      
      google.script.run
        .withSuccessHandler(function(result) {
          console.log('å‰Šé™¤çµæœ:', result);
          
          if (result.success) {
            alert(result.message || 'å‰Šé™¤ã—ã¾ã—ãŸ');
            // ç”»é¢ã‚’å†èª­ã¿è¾¼ã¿
            if (currentMemberId) {
              loadSummary(currentMemberId);
            }
          } else {
            alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + (result.message || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ'));
          }
        })
        .withFailureHandler(function(error) {
          console.error('å‰Šé™¤ã‚¨ãƒ©ãƒ¼:', error);
          alert('å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
        })
        .tw_api_deleteBodyImageRecord(memberId, shootingDate);
    }
    
    // ä½“ã®ç”»åƒãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
    function openBodyImageForm() {
      if (!currentMemberId) {
        alert('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      // ãƒ•ã‚©ãƒ¼ãƒ ã«ä¼šå“¡æƒ…å ±ã‚’è‡ªå‹•å…¥åŠ›
      document.getElementById('bodyImageMemberId').value = currentMemberId;
      document.getElementById('bodyImageMemberName').value = currentMemberName;
      
      // ä»Šæ—¥ã®æ—¥ä»˜ã‚’è¨­å®š
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('bodyImageDate').value = today;
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      document.getElementById('bodyImageModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    // ä½“ã®ç”»åƒãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹
    function closeBodyImageForm() {
      document.getElementById('bodyImageModal').classList.remove('active');
      document.body.style.overflow = 'auto';
      document.getElementById('bodyImageForm').reset();
      document.getElementById('preview1').innerHTML = '';
      document.getElementById('preview2').innerHTML = '';
      document.getElementById('preview3').innerHTML = '';
    }
    
    // ç”»åƒãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
    function previewImage(input, previewId) {
      const preview = document.getElementById(previewId);
      
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          preview.innerHTML = `
            <img src="${e.target.result}" 
                 style="max-width: 200px; max-height: 300px; border-radius: 8px; border: 2px solid #DC143C;">
          `;
        };
        
        reader.readAsDataURL(input.files[0]);
      }
    }
    
    // ä½“ã®ç”»åƒãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    function submitBodyImageForm(event) {
      event.preventDefault();
      
      const submitBtn = event.target.querySelector('.form-submit');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...';
      submitBtn.disabled = true;
      
      // ç”»åƒã‚’Base64ã«å¤‰æ›
      const imagePromises = [];
      const imageInputs = [
        document.getElementById('bodyImage1'),
        document.getElementById('bodyImage2'),
        document.getElementById('bodyImage3')
      ];
      
      imageInputs.forEach(input => {
        if (input.files && input.files[0]) {
          const promise = new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => {
              // Base64ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰"data:image/jpeg;base64,"éƒ¨åˆ†ã‚’å‰Šé™¤
              const base64 = reader.result.split(',')[1];
              resolve(base64);
            };
            reader.onerror = reject;
            reader.readAsDataURL(input.files[0]);
          });
          imagePromises.push(promise);
        }
      });
      
      Promise.all(imagePromises)
        .then(images => {
          const formData = {
            memberId: document.getElementById('bodyImageMemberId').value,
            memberName: document.getElementById('bodyImageMemberName').value,
            shootingDate: document.getElementById('bodyImageDate').value,
            memo: document.getElementById('bodyImageMemo').value,
            images: images
          };
          
          console.log('Sending body image data:', formData);
          
          google.script.run
            .withSuccessHandler(function(result) {
              console.log('Success:', result);
              if (result.success) {
                alert('âœ… ç”»åƒã‚’ä¿å­˜ã—ã¾ã—ãŸï¼');
                closeBodyImageForm();
                // ã‚«ãƒ«ãƒ†ã‚’å†èª­ã¿è¾¼ã¿
                loadSummary(currentMemberId);
                // ä½“ã®ç”»åƒã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
                switchTab('bodyimages');
              } else {
                alert('âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
              }
              submitBtn.textContent = originalText;
              submitBtn.disabled = false;
            })
            .withFailureHandler(function(error) {
              console.error('Failure:', error);
              alert('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
              submitBtn.textContent = originalText;
              submitBtn.disabled = false;
            })
            .tw_api_saveBodyImages(formData);
        })
        .catch(error => {
          console.error('Image conversion error:', error);
          alert('âŒ ç”»åƒã®å¤‰æ›ã«å¤±æ•—ã—ã¾ã—ãŸ');
          submitBtn.textContent = originalText;
          submitBtn.disabled = false;
        });
    }
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    document.getElementById('bodyImageModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeBodyImageForm();
      }
    });
    
    // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‹ã
    function openTrainingForm() {
      if (!currentMemberId) {
        alert('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      // ãƒ•ã‚©ãƒ¼ãƒ ã«ä¼šå“¡æƒ…å ±ã‚’è‡ªå‹•å…¥åŠ›
      document.getElementById('formMemberId').value = currentMemberId;
      document.getElementById('formMemberName').value = currentMemberName;
      
      // åº—èˆ—ã‚’é¸æŠï¼ˆselectedStoreãŒã‚ã‚‹å ´åˆã¯è‡ªå‹•é¸æŠï¼‰
      if (selectedStore) {
        document.getElementById('formStore').value = selectedStore;
      }
      
      // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’è¡¨ç¤º
      document.getElementById('trainingModal').classList.add('active');
      document.body.style.overflow = 'hidden';
    }
    
    // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹
    function closeTrainingForm() {
      document.getElementById('trainingModal').classList.remove('active');
      document.body.style.overflow = 'auto';
      document.getElementById('trainingForm').reset();
      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚³ãƒ³ãƒ†ãƒŠã‚’ã‚¯ãƒªã‚¢
      document.getElementById('menuContainer').innerHTML = '';
      menuCount = 0;
    }
    
    // ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
    function submitTrainingForm(event) {
      console.log('=== submitTrainingForm called ===');
      event.preventDefault();
      
      // éƒ¨ä½ãƒã‚§ãƒƒã‚¯
      const selectedParts = document.getElementById('formBodyPart').value;
      console.log('Selected parts:', selectedParts);
      
      if (!selectedParts) {
        alert('ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°éƒ¨ä½ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      // ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’åé›†
      console.log('Menu count:', menuCount);
      const menus = [];
      for (let i = 1; i <= menuCount; i++) {
        const menuElement = document.getElementById(`menu-${i}`);
        if (!menuElement) continue;
        
        const menuName = document.getElementById(`formMenuName${i}`).value;
        const setCount = parseInt(document.getElementById(`formSetCount${i}`).value) || 0;
        
        if (!menuName || setCount === 0) continue;
        
        const sets = [];
        for (let j = 1; j <= setCount; j++) {
          const weightSelect = document.getElementById(`formWeight${i}_${j}`);
          const repsSelect = document.getElementById(`formReps${i}_${j}`);
          
          const weight = weightSelect ? weightSelect.value : '';
          const reps = repsSelect ? repsSelect.value : '';
          
          if (weight && weight !== 'é¸æŠ' && reps && reps !== 'é¸æŠ') {
            sets.push({
              weight: weight,
              reps: reps
            });
          }
        }
        
        menus.push({
          name: menuName,
          sets: sets
        });
      }
      
      const formData = {
        memberId: document.getElementById('formMemberId').value,
        memberName: document.getElementById('formMemberName').value,
        store: document.getElementById('formStore').value,
        trainer: document.getElementById('formTrainer').value,
        weight: document.getElementById('formWeight').value,
        bodyFat: document.getElementById('formBodyFat').value,
        condition: document.getElementById('formCondition').value,
        bodyParts: selectedParts,
        stretch: document.getElementById('formStretch').value,
        stretchContent: document.getElementById('formStretchContent').value,
        concept: document.getElementById('formConcept').value,
        menus: menus,
        goodPoints: document.getElementById('formGoodPoints').value,
        improvements: document.getElementById('formImprovements').value,
        pain: document.getElementById('formPain').value,
        conversation: document.getElementById('formConversation').value,
        timestamp: new Date().toISOString()
      };
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      const submitBtn = event.target.querySelector('.form-submit');
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'é€ä¿¡ä¸­...';
      submitBtn.disabled = true;
      
      // ãƒ‡ãƒãƒƒã‚°: formDataã‚’ç¢ºèª
      console.log('Sending formData:', formData);
      console.log('formData JSON:', JSON.stringify(formData));
      
      // ã™ãã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’é–‰ã˜ã‚‹ï¼ˆãƒ‡ãƒ¼ã‚¿é€ä¿¡ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ç¶šè¡Œï¼‰
      closeTrainingForm();
      
      // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºï¼ˆéãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰
      setTimeout(function() {
        alert('âœ… ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã—ã¾ã—ãŸï¼\n\nAIåˆ†æã¨ãƒ¡ãƒ¼ãƒ«é€ä¿¡ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡¦ç†ã•ã‚Œã¾ã™ã€‚');
      }, 100);
      
      // ã‚«ãƒ«ãƒ†ã‚’å†èª­ã¿è¾¼ã¿
      if (currentMemberId) {
        loadSummary(currentMemberId);
      }
      
      // Google Apps Scriptã«é€ä¿¡ï¼ˆãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡¦ç†ï¼‰
      google.script.run
        .withSuccessHandler(function(result) {
          console.log('Success:', result);
          if (!result.success) {
            // ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿é€šçŸ¥ï¼ˆéãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰
            setTimeout(function() {
              alert('âš ï¸ é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message + '\n\nãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å†åº¦é€ä¿¡ã—ã¦ãã ã•ã„ã€‚');
            }, 500);
          }
        })
        .withFailureHandler(function(error) {
          console.error('Failure:', error);
          // ã‚¨ãƒ©ãƒ¼æ™‚ã®ã¿é€šçŸ¥ï¼ˆéãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ï¼‰
          setTimeout(function() {
            alert('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message + '\n\nãƒ‡ãƒ¼ã‚¿ã¯ä¿å­˜ã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚å†åº¦é€ä¿¡ã—ã¦ãã ã•ã„ã€‚');
          }, 500);
        })
        .tw_api_submitTraining(formData);
    }
    
    // ãƒ¢ãƒ¼ãƒ€ãƒ«å¤–ã‚¯ãƒªãƒƒã‚¯ã§é–‰ã˜ã‚‹
    document.getElementById('trainingModal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeTrainingForm();
      }
    });
    
    // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
    function switchTab(tabName) {
      // ã‚¤ãƒ™ãƒ³ãƒˆãŒãªã„å ´åˆï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰å‘¼ã°ã‚ŒãŸå ´åˆï¼‰ã®å‡¦ç†
      if (typeof event !== 'undefined' && event && event.target) {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
      } else {
        // ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‹ã‚‰å‘¼ã°ã‚ŒãŸå ´åˆã¯ã€å¯¾å¿œã™ã‚‹ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«
        document.querySelectorAll('.tab').forEach(t => {
          if (t.getAttribute('onclick') && t.getAttribute('onclick').includes(tabName)) {
            t.classList.add('active');
          } else {
            t.classList.remove('active');
          }
        });
      }
      
      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
      document.getElementById('tab-' + tabName).classList.add('active');
      
      currentTab = tabName;
    }
    
    // æœ€æ–°ã‚»ãƒƒã‚·ãƒ§ãƒ³è¡¨ç¤º
    function renderLatest(session) {
      const el = document.getElementById('latest-content');
      if (!session) {
        el.innerHTML = '<div class="empty">ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      let html = `
        <div class="session-item">
          <div class="date">${session.ts || 'æ—¥æ™‚ä¸æ˜'}</div>
          <div class="trainer">æ‹…å½“: ${session.trainer || 'ä¸æ˜'}</div>
          <span class="part">${session.part || 'éƒ¨ä½ä¸æ˜'}</span>
          <div class="menu-list">
      `;
      
      session.menus.forEach((m, i) => {
        html += `<div class="menu-item">ãƒ»${m.menu || 'ç¨®ç›®ä¸æ˜'} ${m.set || ''}</div>`;
      });
      
      html += '</div></div>';
      el.innerHTML = html;
    }
    
    // å§¿å‹¢è©•ä¾¡è¡¨ç¤ºï¼ˆæ‰‹å…¥åŠ›å„ªå…ˆï¼‰
    function renderPosture(aiText, manualData) {
      const el = document.getElementById('posture-content');
      const manualInput = document.getElementById('posture-manual-input');
      
      // æ‰‹å…¥åŠ›ã‚’ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒªã‚¢ã«è¨­å®š
      if (manualData && manualData.text) {
        manualInput.value = manualData.text;
      } else {
        manualInput.value = '';
      }
      
      // è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ï¼šæ‰‹å…¥åŠ›ãŒã‚ã‚Œã°å„ªå…ˆè¡¨ç¤ºã€ãªã‘ã‚Œã°AIçµæœ
      let displayText = '';
      let sourceLabel = '';
      
      if (manualData && manualData.text) {
        displayText = manualData.text;
        sourceLabel = 'æ‰‹å…¥åŠ›è©•ä¾¡';
      } else if (aiText) {
        displayText = aiText;
        sourceLabel = 'AIè©•ä¾¡';
      }
      
      if (!displayText) {
        el.innerHTML = '<div class="empty">å§¿å‹¢è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      el.innerHTML = `
        <div style="margin-top: 20px;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
            <h3 style="margin: 0; color: #DC143C; font-size: 16px;">${sourceLabel}</h3>
            ${manualData && manualData.updatedAt ? `<span style="color: #999; font-size: 14px;">æ›´æ–°æ—¥: ${manualData.updatedAt}</span>` : ''}
          </div>
          <div class="ai-text">${displayText}</div>
        </div>
      `;
    }
    
    // å§¿å‹¢è©•ä¾¡æ‰‹å…¥åŠ›ä¿å­˜
    function savePostureManual() {
      if (!currentMemberId) {
        alert('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      const text = document.getElementById('posture-manual-input').value.trim();
      
      if (!text) {
        alert('ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
        return;
      }
      
      const statusEl = document.getElementById('posture-content');
      statusEl.innerHTML = '<div style="padding: 20px; text-align: center; color: #999;">ä¿å­˜ä¸­...</div>';
      
      google.script.run
        .withSuccessHandler(function(result) {
          if (result.success) {
            alert('âœ… ä¿å­˜ã—ã¾ã—ãŸï¼');
            // ç”»é¢ã‚’å†èª­ã¿è¾¼ã¿
            if (currentMemberId) {
              loadSummary(currentMemberId);
            }
          } else {
            alert('âŒ ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + result.message);
          }
        })
        .withFailureHandler(function(error) {
          console.error('ä¿å­˜ã‚¨ãƒ©ãƒ¼:', error);
          alert('âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
        })
        .tw_api_savePostureManual(currentMemberId, text);
    }
    
    // 2026å¹´ç›®æ¨™AIè¡¨ç¤º
    function renderAi2026(data, idealMetrics, progressPlan) {
      console.log('=== renderAi2026 called ===');
      console.log('data:', data);
      console.log('idealMetrics:', idealMetrics);
      console.log('progressPlan:', progressPlan);
      
      const el = document.getElementById('ai2026-content');
      
      if (!el) {
        console.error('ai2026-content element not found');
        return;
      }
      
      if (!data || !data.text) {
        console.log('No AI 2026 data or text');
        
        // æœªå®Œäº†ç†ç”±ã‚’è¡¨ç¤º
        let reasonMessage = '2026å¹´ç›®æ¨™åˆ†æãŒã¾ã å®Œäº†ã—ã¦ã„ã¾ã›ã‚“';
        if (data && data.incompleteReason) {
          reasonMessage += `<br><span style="color: #FF9500; font-size: 14px; margin-top: 8px; display: block;">ç†ç”±: ${data.incompleteReason}</span>`;
          
          // ç†ç”±ã«å¿œã˜ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿½åŠ 
          if (data.incompleteReason === 'ãƒ’ã‚¢ãƒªãƒ³ã‚°æœªå›ç­”') {
            reasonMessage += `<br><span style="color: #999; font-size: 13px; margin-top: 4px; display: block;">2026ç›®æ¨™ãƒ’ã‚¢ãƒªãƒ³ã‚°_å›ç­”ã‚·ãƒ¼ãƒˆã«è©²å½“IDã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</span>`;
          } else if (data.incompleteReason === 'AIåˆ†ææœªä½œæˆ') {
            reasonMessage += `<br><span style="color: #999; font-size: 13px; margin-top: 4px; display: block;">2026_AIã‚·ãƒ¼ãƒˆã«è©²å½“IDã®åˆ†æçµæœãŒã‚ã‚Šã¾ã›ã‚“</span>`;
          } else if (data.incompleteReason === 'ç›®æ¨™ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼') {
            reasonMessage += `<br><span style="color: #999; font-size: 13px; margin-top: 4px; display: block;">ãƒ‡ãƒ¼ã‚¿å–å¾—ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ</span>`;
          }
        }
        
        el.innerHTML = `<div class="empty">${reasonMessage}</div>`;
        
        // progressPlanãŒç©ºã®å ´åˆã®å‡¦ç†
        const planEl = document.getElementById('progress-plan-content');
        if (planEl) {
          planEl.innerHTML = '';
        }
        return;
      }
      
      let statusClass = 'success';
      if (data.status === 'ERROR' || data.status === 'å¤±æ•—') statusClass = 'error';
      else if (data.status === 'å‡¦ç†ä¸­') statusClass = 'pending';
      
      let html = `
        <span class="ai-status ${statusClass}">${data.status || 'OK'}</span>
        ${data.analyzedAt ? `<span style="color:#999; font-size:14px; margin-left:8px;">åˆ†ææ—¥: ${data.analyzedAt}</span>` : ''}
      `;
      
      if (data.photo) {
        html += `
          <div>
            <h3 style="margin: 16px 0 8px 0;">ğŸ“¸ ç›®æ¨™å†™çœŸ</h3>
            <img src="${data.photo}" class="target-photo" alt="ç›®æ¨™å†™çœŸ" />
          </div>
        `;
      }
      
      html += `
        <div style="margin-top: 20px;">
          <h3 style="margin-bottom: 12px;">ğŸ“Š AIåˆ†æçµæœ</h3>
          <div class="ai-text">${data.text}</div>
        </div>
      `;
      
      el.innerHTML = html;
      
      console.log('Calling renderProgressPlan...');
      renderProgressPlan(progressPlan, data);
      console.log('=== renderAi2026 completed ===');
    }
    
    // é€²æ—ãƒ—ãƒ©ãƒ³è¡¨ç¤º
    function renderProgressPlan(plan, ai2026) {
      const el = document.getElementById('progress-plan-content');
      
      if (!plan || !plan.hasPlan) {
        el.innerHTML = '';
        return;
      }
      
      let html = '<div style="margin-top: 32px;">';
      html += '<h3>ğŸ¯ ç›®æ¨™é”æˆã¸ã®é“ã®ã‚Š</h3>';
      
      if (plan.timeline) {
        const progress = plan.timeline.weeksRemaining > 0 ? 
          Math.max(0, Math.min(100, 100 - (plan.timeline.weeksRemaining / 48 * 100))) : 0;
        
        html += `
          <div class="info-box">
            <div class="title">â±ï¸ ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³</div>
            <div class="content">
              æ®‹ã‚Šæ™‚é–“: <strong>${plan.timeline.monthsRemaining}ãƒ¶æœˆ (${plan.timeline.weeksRemaining}é€±)</strong><br>
              ç›®æ¨™é”æˆæ—¥: <strong>${plan.goals.deadline}</strong><br>
              é€±ã‚ãŸã‚Šã®ç›®æ¨™æ¸›é‡: <strong>${plan.timeline.weeklyWeightLoss}kg</strong>
            </div>
            <div class="progress-bar" style="margin-top: 12px;">
              <div class="progress-bar-fill" style="width: ${progress}%;">${Math.round(progress)}%</div>
            </div>
          </div>
        `;
      }
      
      html += '<h3 style="margin-top: 24px;">ğŸ“Š ç¾åœ¨å€¤ vs ç›®æ¨™å€¤ vs ç†æƒ³å€¤</h3>';
      html += '<table class="comparison-table">';
      html += '<tr><th>é …ç›®</th><th>ç¾åœ¨å€¤</th><th>ç›®æ¨™å€¤</th><th>ç†æƒ³å€¤</th><th>æ®‹ã‚Š</th></tr>';
      
      if (plan.currentStatus.weight && plan.goals.weight) {
        const diff = (plan.currentStatus.weight - plan.goals.weight).toFixed(1);
        html += `
          <tr>
            <td>ä½“é‡</td>
            <td class="current">${plan.currentStatus.weight}kg</td>
            <td class="target">${plan.goals.weight}kg</td>
            <td class="ideal">-</td>
            <td class="diff">${diff}kg</td>
          </tr>
        `;
      }
      
      if (plan.currentStatus.bodyFat && plan.goals.bodyFat) {
        const diff = (plan.currentStatus.bodyFat - plan.goals.bodyFat).toFixed(1);
        html += `
          <tr>
            <td>ä½“è„‚è‚ªç‡</td>
            <td class="current">${plan.currentStatus.bodyFat}%</td>
            <td class="target">${plan.goals.bodyFat}%</td>
            <td class="ideal">12.5%</td>
            <td class="diff">${diff}%</td>
          </tr>
        `;
      }
      
      if (plan.currentStatus.leanMass && plan.goals.leanMass) {
        const diff = (plan.goals.leanMass - plan.currentStatus.leanMass).toFixed(1);
        html += `
          <tr>
            <td>é™¤è„‚è‚ªä½“é‡</td>
            <td class="current">${plan.currentStatus.leanMass}kg</td>
            <td class="target">${plan.goals.leanMass}kg</td>
            <td class="ideal">-</td>
            <td class="diff">+${diff}kg</td>
          </tr>
        `;
      }
      
      if (plan.currentStatus.bmi) {
        html += `
          <tr>
            <td>BMI</td>
            <td class="current">${plan.currentStatus.bmi}</td>
            <td class="target">-</td>
            <td class="ideal">22.0</td>
            <td class="diff">-</td>
          </tr>
        `;
      }
      
      html += '</table>';
      
      if (plan.recommendations && plan.recommendations.length > 0) {
        html += '<h3 style="margin-top: 24px;">ğŸ’¡ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ã‚¢ãƒ‰ãƒã‚¤ã‚¹</h3>';
        
        plan.recommendations.forEach(rec => {
          let priorityClass = 'good';
          let priorityText = rec.priority;
          
          if (rec.priority === 'é«˜') {
            priorityClass = 'high';
            priorityText = 'é‡è¦';
          } else if (rec.priority === 'ä¸­') {
            priorityClass = 'medium';
            priorityText = 'æ¨å¥¨';
          } else if (rec.priority === 'è‰¯å¥½') {
            priorityClass = 'good';
            priorityText = 'ç¶™ç¶š';
          }
          
          html += `
            <div class="recommendation-item">
              <div>
                <span class="category">${rec.category}</span>
                <span class="priority ${priorityClass}">${priorityText}</span>
              </div>
              <div class="message">${rec.message}</div>
              <div class="action">ğŸ’ª ${rec.action}</div>
            </div>
          `;
        });
      }
      
      html += '</div>';
      el.innerHTML = html;
    }
    
    // ç†æƒ³å€¤åˆ†æè¡¨ç¤º
    function renderIdealMetrics(metrics, ai2026) {
      const el = document.getElementById('ideal-content');
      
      if (!metrics || !metrics.hasHeight) {
        el.innerHTML = '<div class="empty">èº«é•·ãƒ‡ãƒ¼ã‚¿ãŒç™»éŒ²ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€ç†æƒ³å€¤ã‚’è¨ˆç®—ã§ãã¾ã›ã‚“ã€‚</div>';
        return;
      }
      
      let html = `
        <div class="info-box">
          <div class="title">ğŸ“ èº«ä½“ãƒ‡ãƒ¼ã‚¿</div>
          <div class="content">
            èº«é•·: <strong>${metrics.height}cm</strong>
            ${metrics.bmi ? `<br>ç¾åœ¨ã®BMI: <strong>${metrics.bmi}</strong>` : ''}
          </div>
        </div>
      `;
      
      // 2026_æœ€æ–°ã‚·ãƒ¼ãƒˆã®è¿½åŠ æƒ…å ±ã‚’è¡¨ç¤º
      if (ai2026) {
        if (ai2026.trainingContent || ai2026.bodyMake1 || ai2026.bodyMake2 || ai2026.bodyMake3) {
          html += '<h3 style="margin-top: 24px;">ğŸ¯ 2026å¹´ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°ç›®æ¨™</h3>';
          html += '<div class="info-box">';
          
          if (ai2026.trainingContent) {
            html += `<div class="title">ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°å†…å®¹</div>`;
            html += `<div class="content">${ai2026.trainingContent}</div>`;
          }
          
          if (ai2026.bodyMake1 || ai2026.bodyMake2 || ai2026.bodyMake3) {
            html += `<div class="title" style="margin-top: 12px;">ãƒœãƒ‡ã‚£ãƒ¡ã‚¤ã‚¯é‡ç‚¹éƒ¨ä½</div>`;
            html += '<div class="content">';
            if (ai2026.bodyMake1) html += `<strong>â‘ </strong> ${ai2026.bodyMake1}<br>`;
            if (ai2026.bodyMake2) html += `<strong>â‘¡</strong> ${ai2026.bodyMake2}<br>`;
            if (ai2026.bodyMake3) html += `<strong>â‘¢</strong> ${ai2026.bodyMake3}`;
            html += '</div>';
          }
          
          html += '</div>';
        }
        
        if (ai2026.bodyMakeHeight || ai2026.bodyMakeWeight || ai2026.bodyMakeBodyFat) {
          html += '<h3 style="margin-top: 24px;">ğŸ“Š ç¾åœ¨ã®ä½“çµ„æˆãƒ‡ãƒ¼ã‚¿ï¼ˆ2026_æœ€æ–°ã‚·ãƒ¼ãƒˆã‚ˆã‚Šï¼‰</h3>';
          html += '<div class="metrics-grid">';
          
          if (ai2026.bodyMakeHeight) {
            html += `
              <div class="metric-box">
                <div class="label">èº«é•·</div>
                <div class="value">${ai2026.bodyMakeHeight}<span class="unit">cm</span></div>
              </div>
            `;
          }
          
          if (ai2026.bodyMakeWeight) {
            html += `
              <div class="metric-box">
                <div class="label">ä½“é‡</div>
                <div class="value">${ai2026.bodyMakeWeight}<span class="unit">kg</span></div>
              </div>
            `;
          }
          
          if (ai2026.bodyMakeBodyFat) {
            html += `
              <div class="metric-box">
                <div class="label">ä½“è„‚è‚ªç‡</div>
                <div class="value">${ai2026.bodyMakeBodyFat}<span class="unit">%</span></div>
              </div>
            `;
          }
          
          html += '</div>';
        }
        
        if (ai2026.numericGoal) {
          html += `
            <div class="info-box" style="margin-top: 16px;">
              <div class="title">æ•°å€¤ç›®æ¨™</div>
              <div class="content">${ai2026.numericGoal}</div>
            </div>
          `;
        }
      }
      
      html += '<h3 style="margin-top: 24px;">ğŸ¯ ç¾åœ¨å€¤ vs 1ãƒ¶æœˆå¾Œã®ç›®æ¨™å€¤</h3>';
      html += '<table class="comparison-table">';
      html += '<tr><th>é …ç›®</th><th>ç¾åœ¨å€¤</th><th>1ãƒ¶æœˆå¾Œã®ç›®æ¨™</th><th>å·®åˆ†</th></tr>';
      
      if (metrics.currentWeight && metrics.idealWeight) {
        const diff = (metrics.currentWeight - metrics.idealWeight).toFixed(1);
        html += `
          <tr>
            <td>ä½“é‡</td>
            <td class="current">${metrics.currentWeight}kg</td>
            <td class="target">${metrics.idealWeight}kg</td>
            <td class="diff">-${diff}kg</td>
          </tr>
        `;
      }
      
      if (metrics.currentBodyFat && metrics.idealBodyFat) {
        const diff = (metrics.currentBodyFat - metrics.idealBodyFat).toFixed(1);
        html += `
          <tr>
            <td>ä½“è„‚è‚ªç‡</td>
            <td class="current">${metrics.currentBodyFat}%</td>
            <td class="target">${metrics.idealBodyFat}%</td>
            <td class="diff">-${diff}%</td>
          </tr>
        `;
      }
      
      if (metrics.currentLeanMass && metrics.idealLeanMass) {
        const diff = (metrics.idealLeanMass - metrics.currentLeanMass).toFixed(1);
        const sign = diff >= 0 ? '+' : '';
        html += `
          <tr>
            <td>é™¤è„‚è‚ªä½“é‡</td>
            <td class="current">${metrics.currentLeanMass}kg</td>
            <td class="target">${metrics.idealLeanMass}kg</td>
            <td class="diff">${sign}${diff}kg</td>
          </tr>
        `;
      }
      
      if (metrics.bmi) {
        const targetBMI = metrics.idealWeight ? 
          Math.round((metrics.idealWeight / Math.pow(metrics.height/100, 2)) * 10) / 10 : '-';
        html += `
          <tr>
            <td>BMI</td>
            <td class="current">${metrics.bmi}</td>
            <td class="target">${targetBMI}</td>
            <td class="diff">-</td>
          </tr>
        `;
      }
      
      html += '</table>';
      
      html += `
        <div class="info-box" style="margin-top: 16px;">
          <div class="title">ğŸ’¡ 1ãƒ¶æœˆã®ç›®æ¨™è¨­å®šã«ã¤ã„ã¦</div>
          <div class="content">
            å¥åº·çš„ãªæ¸›é‡ãƒšãƒ¼ã‚¹ï¼š<strong>æœˆ2kgï¼ˆé€±0.5kgï¼‰</strong><br>
            ä½“è„‚è‚ªç‡ã®æ¸›å°‘ï¼š<strong>æœˆ1%</strong><br>
            é™¤è„‚è‚ªä½“é‡ï¼ˆç­‹è‚‰ï¼‰ï¼š<strong>ç¶­æŒã¾ãŸã¯å¾®å¢—</strong>
          </div>
        </div>
      `;
      
      if (metrics.calculations) {
        html += '<h3 style="margin-top: 24px;">ğŸ½ï¸ æ „é¤Šã‚¬ã‚¤ãƒ‰</h3>';
        html += '<div class="metrics-grid">';
        
        if (metrics.calculations.bmrRange) {
          html += `
            <div class="metric-box">
              <div class="label">åŸºç¤ä»£è¬é‡</div>
              <div class="value">${metrics.calculations.bmrRange.min}-${metrics.calculations.bmrRange.max}<span class="unit">kcal</span></div>
              <div class="sub-info">ä½•ã‚‚ã—ãªãã¦ã‚‚æ¶ˆè²»</div>
            </div>
          `;
        }
        
        if (metrics.calculations.maintenanceCalories) {
          html += `
            <div class="metric-box">
              <div class="label">ç¶­æŒã‚«ãƒ­ãƒªãƒ¼</div>
              <div class="value">${metrics.calculations.maintenanceCalories}<span class="unit">kcal</span></div>
              <div class="sub-info">ä½“é‡ç¶­æŒã«å¿…è¦</div>
            </div>
          `;
        }
        
        if (metrics.calculations.proteinNeeds) {
          html += `
            <div class="metric-box">
              <div class="label">æ¨å¥¨ã‚¿ãƒ³ãƒ‘ã‚¯è³ªé‡</div>
              <div class="value">${metrics.calculations.proteinNeeds.min}-${metrics.calculations.proteinNeeds.max}<span class="unit">g</span></div>
              <div class="sub-info">1æ—¥ã®ç›®æ¨™æ‘‚å–é‡</div>
            </div>
          `;
        }
        
        html += '</div>';
      }
      
      el.innerHTML = html;
    }
    
    // ç›®æ¨™ç”»åƒé¸æŠå‡¦ç†
    function handleGoalPhotoSelect(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      if (!currentMemberId) {
        alert('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      const reader = new FileReader();
      const statusEl = document.getElementById('goal-photo-status');
      const previewEl = document.getElementById('goal-photo-preview');
      
      statusEl.textContent = 'èª­ã¿è¾¼ã¿ä¸­...';
      statusEl.style.color = '#999';
      
      reader.onload = function(e) {
        // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        previewEl.innerHTML = `
          <img src="${e.target.result}" 
               style="max-width: 300px; max-height: 400px; border-radius: 8px; border: 2px solid #DC143C;">
        `;
        
        // Base64ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆdata:image/jpeg;base64, ã®éƒ¨åˆ†ã‚’å‰Šé™¤ï¼‰
        const base64 = e.target.result.split(',')[1];
        
        // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        statusEl.textContent = 'ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­...';
        
        google.script.run
          .withSuccessHandler(function(result) {
            if (result.success) {
              statusEl.textContent = 'âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†ï¼';
              statusEl.style.color = '#34C759';
              
              // ç”»é¢ã‚’å†èª­ã¿è¾¼ã¿
              if (currentMemberId) {
                loadSummary(currentMemberId);
              }
              
              // ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ã‚’ã‚¯ãƒªã‚¢
              document.getElementById('goal-photo-input').value = '';
            } else {
              statusEl.textContent = 'âŒ ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¤±æ•—: ' + result.message;
              statusEl.style.color = '#FF3B30';
              previewEl.innerHTML = '';
            }
          })
          .withFailureHandler(function(error) {
            console.error('ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã‚¨ãƒ©ãƒ¼:', error);
            statusEl.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message;
            statusEl.style.color = '#FF3B30';
            previewEl.innerHTML = '';
          })
          .tw_api_uploadGoalPhoto(currentMemberId, base64, file.name);
      };
      
      reader.onerror = function() {
        statusEl.textContent = 'âŒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼';
        statusEl.style.color = '#FF3B30';
        previewEl.innerHTML = '';
      };
      
      reader.readAsDataURL(file);
    }
    
    // AIåˆ†æå®Ÿè¡Œå‡¦ç†
    function runGoalAnalysis() {
      if (!currentMemberId) {
        alert('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      const btn = document.getElementById('run-goal-analysis-btn');
      const statusEl = document.getElementById('goal-analysis-status');
      
      // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
      btn.disabled = true;
      btn.textContent = 'â³ åˆ†æä¸­...';
      statusEl.textContent = 'AIåˆ†æã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™ã€‚ã—ã°ã‚‰ããŠå¾…ã¡ãã ã•ã„...';
      statusEl.style.color = '#FF9500';
      
      google.script.run
        .withSuccessHandler(function(result) {
          btn.disabled = false;
          btn.textContent = 'ğŸš€ AIåˆ†æã‚’å®Ÿè¡Œ';
          
          if (result.success) {
            statusEl.textContent = 'âœ… ' + (result.message || 'AIåˆ†æãŒå®Œäº†ã—ã¾ã—ãŸï¼');
            statusEl.style.color = '#34C759';
            
            // ç”»é¢ã‚’å†èª­ã¿è¾¼ã¿
            if (currentMemberId) {
              setTimeout(function() {
                loadSummary(currentMemberId);
              }, 1000);
            }
          } else {
            statusEl.textContent = 'âŒ ' + (result.message || 'AIåˆ†æã«å¤±æ•—ã—ã¾ã—ãŸ');
            statusEl.style.color = '#FF3B30';
          }
        })
        .withFailureHandler(function(error) {
          console.error('AIåˆ†æã‚¨ãƒ©ãƒ¼:', error);
          btn.disabled = false;
          btn.textContent = 'ğŸš€ AIåˆ†æã‚’å®Ÿè¡Œ';
          statusEl.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message;
          statusEl.style.color = '#FF3B30';
        })
        .tw_api_runGoalAnalysis(currentMemberId);
    }
    
    // å±¥æ­´ä¸€è¦§è¡¨ç¤º
    function renderHistory(list) {
      const el = document.getElementById('history-content');
      if (!list || list.length === 0) {
        el.innerHTML = '<div class="empty">å±¥æ­´ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      let html = '';
      list.forEach(s => {
        html += `
          <div class="session-item">
            <div class="date">${s.ts || 'æ—¥æ™‚ä¸æ˜'}</div>
            <div class="trainer">æ‹…å½“: ${s.trainer || 'ä¸æ˜'}</div>
            <span class="part">${s.part || 'éƒ¨ä½ä¸æ˜'}</span>
            <div class="menu-list">
        `;
        
        s.menus.forEach(m => {
          html += `<div class="menu-item">ãƒ»${m.menu || 'ç¨®ç›®ä¸æ˜'} ${m.set || ''}</div>`;
        });
        
        html += '</div></div>';
      });
      
      el.innerHTML = html;
    }
    
    // è©•ä¾¡ä¸€è¦§è¡¨ç¤º
    function renderRatings(ratings) {
      const el = document.getElementById('ratings-content');
      if (!ratings || ratings.length === 0) {
        el.innerHTML = '<div class="empty">è©•ä¾¡ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
        return;
      }
      
      let html = '';
      ratings.forEach(r => {
        const stars = 'â­'.repeat(r.rating) + 'â˜†'.repeat(5 - r.rating);
        const ratingText = ['', 'ğŸ˜ æ”¹å–„ãŒå¿…è¦', 'ğŸ˜ ã‚„ã‚„ä¸æº€', 'ğŸ™‚ æ™®é€š', 'ğŸ˜Š æº€è¶³', 'ğŸ˜ ã¨ã¦ã‚‚æº€è¶³'][r.rating] || '';
        
        html += `
          <div class="session-item">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <div class="date">${r.date || 'æ—¥æ™‚ä¸æ˜'}</div>
              <div style="font-size: 24px;">${stars}</div>
            </div>
            <div style="color: rgba(255, 255, 255, 0.8); margin-bottom: 8px;">
              ${ratingText} (${r.rating}/5)
            </div>
            ${r.comment ? `<div style="color: rgba(255, 255, 255, 0.9); padding: 12px; background: rgba(220, 20, 60, 0.1); border-radius: 8px; margin-top: 8px; white-space: pre-wrap;">${r.comment}</div>` : ''}
            ${r.trainer ? `<div style="color: rgba(255, 255, 255, 0.6); font-size: 14px; margin-top: 8px;">æ‹…å½“: ${r.trainer}</div>` : ''}
          </div>
        `;
      });
      
      el.innerHTML = html;
    }
    
    // 1æœˆåˆ†æãƒ»2æœˆææ¡ˆã‚’å®Ÿè¡Œ
    function runJanuaryAnalysis() {
      if (!currentMemberId) {
        alert('ä¼šå“¡ã‚’é¸æŠã—ã¦ãã ã•ã„');
        return;
      }
      
      const statusEl = document.getElementById('january-analysis-status');
      const contentEl = document.getElementById('january-analysis-content');
      
      statusEl.textContent = 'åˆ†æä¸­...';
      contentEl.innerHTML = '<div style="padding: 40px; text-align: center; color: #999;">åˆ†æã‚’å®Ÿè¡Œã—ã¦ã„ã¾ã™...</div>';
      
      google.script.run
        .withSuccessHandler(function(result) {
          console.log('January analysis result:', result);
          statusEl.textContent = result.success ? 'âœ… åˆ†æå®Œäº†' : 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
          
          if (result.success) {
            renderJanuaryAnalysis(result.data);
          } else {
            contentEl.innerHTML = `<div class="empty">ã‚¨ãƒ©ãƒ¼: ${result.message || 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼'}</div>`;
          }
        })
        .withFailureHandler(function(error) {
          console.error('January analysis error:', error);
          statusEl.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';
          contentEl.innerHTML = `<div class="empty">ã‚¨ãƒ©ãƒ¼: ${error.message}</div>`;
        })
        .tw_api_analyzeJanuaryAndPlanFebruary(currentMemberId);
    }
    
    // 1æœˆåˆ†æçµæœã‚’è¡¨ç¤º
    function renderJanuaryAnalysis(data) {
      const el = document.getElementById('january-analysis-content');
      
      let html = '';
      
      // 1æœˆã®æˆé•·åˆ†æ
      if (data.januaryAnalysis) {
        html += `
          <div style="margin-bottom: 32px;">
            <h3 style="color: #DC143C; margin-bottom: 16px; font-size: 20px;">ğŸ“Š 1æœˆã®æˆé•·åˆ†æ</h3>
            <div class="ai-text">${data.januaryAnalysis.replace(/\n/g, '<br>')}</div>
          </div>
        `;
      }
      
      // 2æœˆã®é€²ã‚æ–¹
      if (data.februaryPlan) {
        html += `
          <div style="margin-bottom: 32px;">
            <h3 style="color: #DC143C; margin-bottom: 16px; font-size: 20px;">ğŸ¯ 2æœˆã®é€²ã‚æ–¹</h3>
            <div class="ai-text">${data.februaryPlan.replace(/\n/g, '<br>')}</div>
          </div>
        `;
      }
      
      // ã‚»ãƒƒã‚·ãƒ§ãƒ³å›æ•°ã¨æˆé•·äºˆæ¸¬
      if (data.sessionPlan) {
        html += `
          <div style="margin-bottom: 32px;">
            <h3 style="color: #DC143C; margin-bottom: 16px; font-size: 20px;">ğŸ“ˆ ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨ˆç”»ã¨æˆé•·äºˆæ¸¬</h3>
            <div class="ai-text">${data.sessionPlan.replace(/\n/g, '<br>')}</div>
          </div>
        `;
      }
      
      // çµ±è¨ˆæƒ…å ±
      if (data.stats) {
        html += `
          <div style="margin-top: 32px; padding: 20px; background: rgba(220, 20, 60, 0.1); border-radius: 12px; border-left: 5px solid #DC143C;">
            <h4 style="color: #DC143C; margin-bottom: 12px;">ğŸ“Š 1æœˆã®çµ±è¨ˆ</h4>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px;">
        `;
        
        if (data.stats.sessionCount !== undefined) {
          html += `
            <div class="metric-box">
              <div class="label">ã‚»ãƒƒã‚·ãƒ§ãƒ³å›æ•°</div>
              <div class="value">${data.stats.sessionCount}<span class="unit">å›</span></div>
            </div>
          `;
        }
        
        if (data.stats.weightChange !== undefined && data.stats.weightChange !== null) {
          html += `
            <div class="metric-box">
              <div class="label">ä½“é‡å¤‰åŒ–</div>
              <div class="value">${data.stats.weightChange > 0 ? '+' : ''}${data.stats.weightChange}<span class="unit">kg</span></div>
            </div>
          `;
        }
        
        if (data.stats.bodyFatChange !== undefined && data.stats.bodyFatChange !== null) {
          html += `
            <div class="metric-box">
              <div class="label">ä½“è„‚è‚ªç‡å¤‰åŒ–</div>
              <div class="value">${data.stats.bodyFatChange > 0 ? '+' : ''}${data.stats.bodyFatChange}<span class="unit">%</span></div>
            </div>
          `;
        }
        
        html += `
            </div>
          </div>
        `;
      }
      
      el.innerHTML = html || '<div class="empty">ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“</div>';
    }
  </script>
</body>
</html>